"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractStructTag = exports.extractReference = exports.extractMutableReference = exports.SuiMoveNormalizedModules = exports.SuiMoveNormalizedModule = exports.SuiMoveNormalizedStruct = exports.SuiMoveNormalizedField = exports.SuiMoveNormalizedFunction = exports.SuiMoveNormalizedStructType = exports.SuiMoveNormalizedType = exports.SuiMoveNormalizedTypeParameterType = exports.SuiMoveStructTypeParameter = exports.SuiMoveAbilitySet = exports.SuiMoveVisibility = exports.SuiMoveModuleId = exports.SuiMoveFunctionArgTypes = exports.SuiMoveFunctionArgType = void 0;
const superstruct_1 = require("superstruct");
exports.SuiMoveFunctionArgType = superstruct_1.union([superstruct_1.string(), superstruct_1.object({ Object: superstruct_1.string() })]);
exports.SuiMoveFunctionArgTypes = superstruct_1.array(exports.SuiMoveFunctionArgType);
exports.SuiMoveModuleId = superstruct_1.object({
    address: superstruct_1.string(),
    name: superstruct_1.string(),
});
exports.SuiMoveVisibility = superstruct_1.union([superstruct_1.literal('Private'), superstruct_1.literal('Public'), superstruct_1.literal('Friend')]);
exports.SuiMoveAbilitySet = superstruct_1.object({
    abilities: superstruct_1.array(superstruct_1.string()),
});
exports.SuiMoveStructTypeParameter = superstruct_1.object({
    constraints: exports.SuiMoveAbilitySet,
    isPhantom: superstruct_1.boolean(),
});
exports.SuiMoveNormalizedTypeParameterType = superstruct_1.object({
    TypeParameter: superstruct_1.number(),
});
function isSuiMoveNormalizedType(value) {
    if (!value)
        return false;
    if (typeof value === 'string')
        return true;
    if (superstruct_1.is(value, exports.SuiMoveNormalizedTypeParameterType))
        return true;
    if (isSuiMoveNormalizedStructType(value))
        return true;
    if (typeof value !== 'object')
        return false;
    const valueProperties = value;
    if (superstruct_1.is(valueProperties.Reference, exports.SuiMoveNormalizedType))
        return true;
    if (superstruct_1.is(valueProperties.MutableReference, exports.SuiMoveNormalizedType))
        return true;
    if (superstruct_1.is(valueProperties.Vector, exports.SuiMoveNormalizedType))
        return true;
    return false;
}
exports.SuiMoveNormalizedType = superstruct_1.define('SuiMoveNormalizedType', isSuiMoveNormalizedType);
function isSuiMoveNormalizedStructType(value) {
    if (!value || typeof value !== 'object')
        return false;
    const valueProperties = value;
    if (!valueProperties.Struct || typeof valueProperties.Struct !== 'object')
        return false;
    const structProperties = valueProperties.Struct;
    if (typeof structProperties.address !== 'string' ||
        typeof structProperties.module !== 'string' ||
        typeof structProperties.name !== 'string' ||
        !Array.isArray(structProperties.typeArguments) ||
        !structProperties.typeArguments.every((value) => isSuiMoveNormalizedType(value))) {
        return false;
    }
    return true;
}
// NOTE: This type is recursive, so we need to manually implement it:
exports.SuiMoveNormalizedStructType = superstruct_1.define('SuiMoveNormalizedStructType', isSuiMoveNormalizedStructType);
exports.SuiMoveNormalizedFunction = superstruct_1.object({
    visibility: exports.SuiMoveVisibility,
    isEntry: superstruct_1.boolean(),
    typeParameters: superstruct_1.array(exports.SuiMoveAbilitySet),
    parameters: superstruct_1.array(exports.SuiMoveNormalizedType),
    return: superstruct_1.array(exports.SuiMoveNormalizedType),
});
exports.SuiMoveNormalizedField = superstruct_1.object({
    name: superstruct_1.string(),
    type: exports.SuiMoveNormalizedType,
});
exports.SuiMoveNormalizedStruct = superstruct_1.object({
    abilities: exports.SuiMoveAbilitySet,
    typeParameters: superstruct_1.array(exports.SuiMoveStructTypeParameter),
    fields: superstruct_1.array(exports.SuiMoveNormalizedField),
});
exports.SuiMoveNormalizedModule = superstruct_1.object({
    fileFormatVersion: superstruct_1.number(),
    address: superstruct_1.string(),
    name: superstruct_1.string(),
    friends: superstruct_1.array(exports.SuiMoveModuleId),
    structs: superstruct_1.record(superstruct_1.string(), exports.SuiMoveNormalizedStruct),
    exposedFunctions: superstruct_1.record(superstruct_1.string(), exports.SuiMoveNormalizedFunction),
});
exports.SuiMoveNormalizedModules = superstruct_1.record(superstruct_1.string(), exports.SuiMoveNormalizedModule);
function extractMutableReference(normalizedType) {
    return typeof normalizedType === 'object' && 'MutableReference' in normalizedType
        ? normalizedType.MutableReference
        : undefined;
}
exports.extractMutableReference = extractMutableReference;
function extractReference(normalizedType) {
    return typeof normalizedType === 'object' && 'Reference' in normalizedType ? normalizedType.Reference : undefined;
}
exports.extractReference = extractReference;
function extractStructTag(normalizedType) {
    if (typeof normalizedType === 'object' && 'Struct' in normalizedType) {
        return normalizedType;
    }
    const ref = extractReference(normalizedType);
    const mutRef = extractMutableReference(normalizedType);
    if (typeof ref === 'object' && 'Struct' in ref) {
        return ref;
    }
    if (typeof mutRef === 'object' && 'Struct' in mutRef) {
        return mutRef;
    }
    return undefined;
}
exports.extractStructTag = extractStructTag;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9ybWFsaXplZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvbXlzdGVubGFiL3R5cGVzL25vcm1hbGl6ZWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkNBQWdIO0FBSW5HLFFBQUEsc0JBQXNCLEdBQUcsbUJBQUssQ0FBQyxDQUFDLG9CQUFNLEVBQUUsRUFBRSxvQkFBTSxDQUFDLEVBQUUsTUFBTSxFQUFFLG9CQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRXpFLFFBQUEsdUJBQXVCLEdBQUcsbUJBQUssQ0FBQyw4QkFBc0IsQ0FBQyxDQUFDO0FBR3hELFFBQUEsZUFBZSxHQUFHLG9CQUFNLENBQUM7SUFDcEMsT0FBTyxFQUFFLG9CQUFNLEVBQUU7SUFDakIsSUFBSSxFQUFFLG9CQUFNLEVBQUU7Q0FDZixDQUFDLENBQUM7QUFHVSxRQUFBLGlCQUFpQixHQUFHLG1CQUFLLENBQUMsQ0FBQyxxQkFBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFLHFCQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUscUJBQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFHdEYsUUFBQSxpQkFBaUIsR0FBRyxvQkFBTSxDQUFDO0lBQ3RDLFNBQVMsRUFBRSxtQkFBSyxDQUFDLG9CQUFNLEVBQUUsQ0FBQztDQUMzQixDQUFDLENBQUM7QUFHVSxRQUFBLDBCQUEwQixHQUFHLG9CQUFNLENBQUM7SUFDL0MsV0FBVyxFQUFFLHlCQUFpQjtJQUM5QixTQUFTLEVBQUUscUJBQU8sRUFBRTtDQUNyQixDQUFDLENBQUM7QUFHVSxRQUFBLGtDQUFrQyxHQUFHLG9CQUFNLENBQUM7SUFDdkQsYUFBYSxFQUFFLG9CQUFNLEVBQUU7Q0FDeEIsQ0FBQyxDQUFDO0FBV0gsU0FBUyx1QkFBdUIsQ0FBQyxLQUFjO0lBQzdDLElBQUksQ0FBQyxLQUFLO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFDekIsSUFBSSxP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LE9BQU8sTUFBTSxDQUFDO0tBQ2Y7SUFDRCxPQUFPLFNBQVMsQ0FBQztBQUNuQixDQUFDO0FBaEJELDRDQWdCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFycmF5LCBJbmZlciwgb2JqZWN0LCBzdHJpbmcsIHVuaW9uLCBib29sZWFuLCBkZWZpbmUsIG51bWJlciwgbGl0ZXJhbCwgcmVjb3JkLCBpcyB9IGZyb20gJ3N1cGVyc3RydWN0JztcblxuZXhwb3J0IHR5cGUgU3VpTW92ZUZ1bmN0aW9uQXJnVHlwZXNSZXNwb25zZSA9IEluZmVyPHR5cGVvZiBTdWlNb3ZlRnVuY3Rpb25BcmdUeXBlPltdO1xuXG5leHBvcnQgY29uc3QgU3VpTW92ZUZ1bmN0aW9uQXJnVHlwZSA9IHVuaW9uKFtzdHJpbmcoKSwgb2JqZWN0KHsgT2JqZWN0OiBzdHJpbmcoKSB9KV0pO1xuXG5leHBvcnQgY29uc3QgU3VpTW92ZUZ1bmN0aW9uQXJnVHlwZXMgPSBhcnJheShTdWlNb3ZlRnVuY3Rpb25BcmdUeXBlKTtcbmV4cG9ydCB0eXBlIFN1aU1vdmVGdW5jdGlvbkFyZ1R5cGVzID0gSW5mZXI8dHlwZW9mIFN1aU1vdmVGdW5jdGlvbkFyZ1R5cGVzPjtcblxuZXhwb3J0IGNvbnN0IFN1aU1vdmVNb2R1bGVJZCA9IG9iamVjdCh7XG4gIGFkZHJlc3M6IHN0cmluZygpLFxuICBuYW1lOiBzdHJpbmcoKSxcbn0pO1xuZXhwb3J0IHR5cGUgU3VpTW92ZU1vZHVsZUlkID0gSW5mZXI8dHlwZW9mIFN1aU1vdmVNb2R1bGVJZD47XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlVmlzaWJpbGl0eSA9IHVuaW9uKFtsaXRlcmFsKCdQcml2YXRlJyksIGxpdGVyYWwoJ1B1YmxpYycpLCBsaXRlcmFsKCdGcmllbmQnKV0pO1xuZXhwb3J0IHR5cGUgU3VpTW92ZVZpc2liaWxpdHkgPSBJbmZlcjx0eXBlb2YgU3VpTW92ZVZpc2liaWxpdHk+O1xuXG5leHBvcnQgY29uc3QgU3VpTW92ZUFiaWxpdHlTZXQgPSBvYmplY3Qoe1xuICBhYmlsaXRpZXM6IGFycmF5KHN0cmluZygpKSxcbn0pO1xuZXhwb3J0IHR5cGUgU3VpTW92ZUFiaWxpdHlTZXQgPSBJbmZlcjx0eXBlb2YgU3VpTW92ZUFiaWxpdHlTZXQ+O1xuXG5leHBvcnQgY29uc3QgU3VpTW92ZVN0cnVjdFR5cGVQYXJhbWV0ZXIgPSBvYmplY3Qoe1xuICBjb25zdHJhaW50czogU3VpTW92ZUFiaWxpdHlTZXQsXG4gIGlzUGhhbnRvbTogYm9vbGVhbigpLFxufSk7XG5leHBvcnQgdHlwZSBTdWlNb3ZlU3RydWN0VHlwZVBhcmFtZXRlciA9IEluZmVyPHR5cGVvZiBTdWlNb3ZlU3RydWN0VHlwZVBhcmFtZXRlcj47XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlTm9ybWFsaXplZFR5cGVQYXJhbWV0ZXJUeXBlID0gb2JqZWN0KHtcbiAgVHlwZVBhcmFtZXRlcjogbnVtYmVyKCksXG59KTtcbmV4cG9ydCB0eXBlIFN1aU1vdmVOb3JtYWxpemVkVHlwZVBhcmFtZXRlclR5cGUgPSBJbmZlcjx0eXBlb2YgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlUGFyYW1ldGVyVHlwZT47XG5cbmV4cG9ydCB0eXBlIFN1aU1vdmVOb3JtYWxpemVkVHlwZSA9XG4gIHwgc3RyaW5nXG4gIHwgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlUGFyYW1ldGVyVHlwZVxuICB8IHsgUmVmZXJlbmNlOiBTdWlNb3ZlTm9ybWFsaXplZFR5cGUgfVxuICB8IHsgTXV0YWJsZVJlZmVyZW5jZTogU3VpTW92ZU5vcm1hbGl6ZWRUeXBlIH1cbiAgfCB7IFZlY3RvcjogU3VpTW92ZU5vcm1hbGl6ZWRUeXBlIH1cbiAgfCBTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdFR5cGU7XG5cbmZ1bmN0aW9uIGlzU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlIHtcbiAgaWYgKCF2YWx1ZSkgcmV0dXJuIGZhbHNlO1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgcmV0dXJuIHRydWU7XG4gIGlmIChpcyh2YWx1ZSwgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlUGFyYW1ldGVyVHlwZSkpIHJldHVybiB0cnVlO1xuICBpZiAoaXNTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdFR5cGUodmFsdWUpKSByZXR1cm4gdHJ1ZTtcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcpIHJldHVybiBmYWxzZTtcblxuICBjb25zdCB2YWx1ZVByb3BlcnRpZXMgPSB2YWx1ZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgaWYgKGlzKHZhbHVlUHJvcGVydGllcy5SZWZlcmVuY2UsIFN1aU1vdmVOb3JtYWxpemVkVHlwZSkpIHJldHVybiB0cnVlO1xuICBpZiAoaXModmFsdWVQcm9wZXJ0aWVzLk11dGFibGVSZWZlcmVuY2UsIFN1aU1vdmVOb3JtYWxpemVkVHlwZSkpIHJldHVybiB0cnVlO1xuICBpZiAoaXModmFsdWVQcm9wZXJ0aWVzLlZlY3RvciwgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKSkgcmV0dXJuIHRydWU7XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZXhwb3J0IGNvbnN0IFN1aU1vdmVOb3JtYWxpemVkVHlwZSA9IGRlZmluZTxTdWlNb3ZlTm9ybWFsaXplZFR5cGU+KCdTdWlNb3ZlTm9ybWFsaXplZFR5cGUnLCBpc1N1aU1vdmVOb3JtYWxpemVkVHlwZSk7XG5cbmV4cG9ydCB0eXBlIFN1aU1vdmVOb3JtYWxpemVkU3RydWN0VHlwZSA9IHtcbiAgU3RydWN0OiB7XG4gICAgYWRkcmVzczogc3RyaW5nO1xuICAgIG1vZHVsZTogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB0eXBlQXJndW1lbnRzOiBTdWlNb3ZlTm9ybWFsaXplZFR5cGVbXTtcbiAgfTtcbn07XG5cbmZ1bmN0aW9uIGlzU3VpTW92ZU5vcm1hbGl6ZWRTdHJ1Y3RUeXBlKHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgU3VpTW92ZU5vcm1hbGl6ZWRTdHJ1Y3RUeXBlIHtcbiAgaWYgKCF2YWx1ZSB8fCB0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnKSByZXR1cm4gZmFsc2U7XG5cbiAgY29uc3QgdmFsdWVQcm9wZXJ0aWVzID0gdmFsdWUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIGlmICghdmFsdWVQcm9wZXJ0aWVzLlN0cnVjdCB8fCB0eXBlb2YgdmFsdWVQcm9wZXJ0aWVzLlN0cnVjdCAhPT0gJ29iamVjdCcpIHJldHVybiBmYWxzZTtcblxuICBjb25zdCBzdHJ1Y3RQcm9wZXJ0aWVzID0gdmFsdWVQcm9wZXJ0aWVzLlN0cnVjdCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgaWYgKFxuICAgIHR5cGVvZiBzdHJ1Y3RQcm9wZXJ0aWVzLmFkZHJlc3MgIT09ICdzdHJpbmcnIHx8XG4gICAgdHlwZW9mIHN0cnVjdFByb3BlcnRpZXMubW9kdWxlICE9PSAnc3RyaW5nJyB8fFxuICAgIHR5cGVvZiBzdHJ1Y3RQcm9wZXJ0aWVzLm5hbWUgIT09ICdzdHJpbmcnIHx8XG4gICAgIUFycmF5LmlzQXJyYXkoc3RydWN0UHJvcGVydGllcy50eXBlQXJndW1lbnRzKSB8fFxuICAgICFzdHJ1Y3RQcm9wZXJ0aWVzLnR5cGVBcmd1bWVudHMuZXZlcnkoKHZhbHVlKSA9PiBpc1N1aU1vdmVOb3JtYWxpemVkVHlwZSh2YWx1ZSkpXG4gICkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuXG4vLyBOT1RFOiBUaGlzIHR5cGUgaXMgcmVjdXJzaXZlLCBzbyB3ZSBuZWVkIHRvIG1hbnVhbGx5IGltcGxlbWVudCBpdDpcbmV4cG9ydCBjb25zdCBTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdFR5cGUgPSBkZWZpbmU8U3VpTW92ZU5vcm1hbGl6ZWRTdHJ1Y3RUeXBlPihcbiAgJ1N1aU1vdmVOb3JtYWxpemVkU3RydWN0VHlwZScsXG4gIGlzU3VpTW92ZU5vcm1hbGl6ZWRTdHJ1Y3RUeXBlXG4pO1xuXG5leHBvcnQgY29uc3QgU3VpTW92ZU5vcm1hbGl6ZWRGdW5jdGlvbiA9IG9iamVjdCh7XG4gIHZpc2liaWxpdHk6IFN1aU1vdmVWaXNpYmlsaXR5LFxuICBpc0VudHJ5OiBib29sZWFuKCksXG4gIHR5cGVQYXJhbWV0ZXJzOiBhcnJheShTdWlNb3ZlQWJpbGl0eVNldCksXG4gIHBhcmFtZXRlcnM6IGFycmF5KFN1aU1vdmVOb3JtYWxpemVkVHlwZSksXG4gIHJldHVybjogYXJyYXkoU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKSxcbn0pO1xuZXhwb3J0IHR5cGUgU3VpTW92ZU5vcm1hbGl6ZWRGdW5jdGlvbiA9IEluZmVyPHR5cGVvZiBTdWlNb3ZlTm9ybWFsaXplZEZ1bmN0aW9uPjtcblxuZXhwb3J0IGNvbnN0IFN1aU1vdmVOb3JtYWxpemVkRmllbGQgPSBvYmplY3Qoe1xuICBuYW1lOiBzdHJpbmcoKSxcbiAgdHlwZTogU3VpTW92ZU5vcm1hbGl6ZWRUeXBlLFxufSk7XG5leHBvcnQgdHlwZSBTdWlNb3ZlTm9ybWFsaXplZEZpZWxkID0gSW5mZXI8dHlwZW9mIFN1aU1vdmVOb3JtYWxpemVkRmllbGQ+O1xuXG5leHBvcnQgY29uc3QgU3VpTW92ZU5vcm1hbGl6ZWRTdHJ1Y3QgPSBvYmplY3Qoe1xuICBhYmlsaXRpZXM6IFN1aU1vdmVBYmlsaXR5U2V0LFxuICB0eXBlUGFyYW1ldGVyczogYXJyYXkoU3VpTW92ZVN0cnVjdFR5cGVQYXJhbWV0ZXIpLFxuICBmaWVsZHM6IGFycmF5KFN1aU1vdmVOb3JtYWxpemVkRmllbGQpLFxufSk7XG5leHBvcnQgdHlwZSBTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdCA9IEluZmVyPHR5cGVvZiBTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdD47XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlTm9ybWFsaXplZE1vZHVsZSA9IG9iamVjdCh7XG4gIGZpbGVGb3JtYXRWZXJzaW9uOiBudW1iZXIoKSxcbiAgYWRkcmVzczogc3RyaW5nKCksXG4gIG5hbWU6IHN0cmluZygpLFxuICBmcmllbmRzOiBhcnJheShTdWlNb3ZlTW9kdWxlSWQpLFxuICBzdHJ1Y3RzOiByZWNvcmQoc3RyaW5nKCksIFN1aU1vdmVOb3JtYWxpemVkU3RydWN0KSxcbiAgZXhwb3NlZEZ1bmN0aW9uczogcmVjb3JkKHN0cmluZygpLCBTdWlNb3ZlTm9ybWFsaXplZEZ1bmN0aW9uKSxcbn0pO1xuZXhwb3J0IHR5cGUgU3VpTW92ZU5vcm1hbGl6ZWRNb2R1bGUgPSBJbmZlcjx0eXBlb2YgU3VpTW92ZU5vcm1hbGl6ZWRNb2R1bGU+O1xuXG5leHBvcnQgY29uc3QgU3VpTW92ZU5vcm1hbGl6ZWRNb2R1bGVzID0gcmVjb3JkKHN0cmluZygpLCBTdWlNb3ZlTm9ybWFsaXplZE1vZHVsZSk7XG5leHBvcnQgdHlwZSBTdWlNb3ZlTm9ybWFsaXplZE1vZHVsZXMgPSBJbmZlcjx0eXBlb2YgU3VpTW92ZU5vcm1hbGl6ZWRNb2R1bGVzPjtcblxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RNdXRhYmxlUmVmZXJlbmNlKG5vcm1hbGl6ZWRUeXBlOiBTdWlNb3ZlTm9ybWFsaXplZFR5cGUpOiBTdWlNb3ZlTm9ybWFsaXplZFR5cGUgfCB1bmRlZmluZWQge1xuICByZXR1cm4gdHlwZW9mIG5vcm1hbGl6ZWRUeXBlID09PSAnb2JqZWN0JyAmJiAnTXV0YWJsZVJlZmVyZW5jZScgaW4gbm9ybWFsaXplZFR5cGVcbiAgICA/IG5vcm1hbGl6ZWRUeXBlLk11dGFibGVSZWZlcmVuY2VcbiAgICA6IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RSZWZlcmVuY2Uobm9ybWFsaXplZFR5cGU6IFN1aU1vdmVOb3JtYWxpemVkVHlwZSk6IFN1aU1vdmVOb3JtYWxpemVkVHlwZSB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiB0eXBlb2Ygbm9ybWFsaXplZFR5cGUgPT09ICdvYmplY3QnICYmICdSZWZlcmVuY2UnIGluIG5vcm1hbGl6ZWRUeXBlID8gbm9ybWFsaXplZFR5cGUuUmVmZXJlbmNlIDogdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdFN0cnVjdFRhZyhub3JtYWxpemVkVHlwZTogU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKTogU3VpTW92ZU5vcm1hbGl6ZWRTdHJ1Y3RUeXBlIHwgdW5kZWZpbmVkIHtcbiAgaWYgKHR5cGVvZiBub3JtYWxpemVkVHlwZSA9PT0gJ29iamVjdCcgJiYgJ1N0cnVjdCcgaW4gbm9ybWFsaXplZFR5cGUpIHtcbiAgICByZXR1cm4gbm9ybWFsaXplZFR5cGU7XG4gIH1cblxuICBjb25zdCByZWYgPSBleHRyYWN0UmVmZXJlbmNlKG5vcm1hbGl6ZWRUeXBlKTtcbiAgY29uc3QgbXV0UmVmID0gZXh0cmFjdE11dGFibGVSZWZlcmVuY2Uobm9ybWFsaXplZFR5cGUpO1xuXG4gIGlmICh0eXBlb2YgcmVmID09PSAnb2JqZWN0JyAmJiAnU3RydWN0JyBpbiByZWYpIHtcbiAgICByZXR1cm4gcmVmO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBtdXRSZWYgPT09ICdvYmplY3QnICYmICdTdHJ1Y3QnIGluIG11dFJlZikge1xuICAgIHJldHVybiBtdXRSZWY7XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cbiJdfQ==