"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Transactions = exports.getTransactionType = exports.TransactionType = exports.PublishTransaction = exports.MakeMoveVecTransaction = exports.MergeCoinsTransaction = exports.SplitCoinsTransaction = exports.TransferObjectsTransaction = exports.MoveCallTransaction = exports.PureTransactionArgument = exports.ObjectTransactionArgument = exports.TransactionArgument = exports.TransactionBlockInput = void 0;
const bcs_1 = require("@mysten/bcs");
const superstruct_1 = require("superstruct");
const common_1 = require("../types/common");
const utils_1 = require("./utils");
const option = (some) => superstruct_1.union([superstruct_1.object({ None: superstruct_1.literal(null) }), superstruct_1.object({ Some: some })]);
exports.TransactionBlockInput = superstruct_1.object({
    kind: superstruct_1.literal('Input'),
    index: superstruct_1.integer(),
    value: superstruct_1.optional(superstruct_1.any()),
    type: superstruct_1.optional(superstruct_1.union([superstruct_1.literal('pure'), superstruct_1.literal('object')])),
});
const TransactionArgumentTypes = [
    exports.TransactionBlockInput,
    superstruct_1.object({ kind: superstruct_1.literal('GasCoin') }),
    superstruct_1.object({ kind: superstruct_1.literal('Result'), index: superstruct_1.integer() }),
    superstruct_1.object({
        kind: superstruct_1.literal('NestedResult'),
        index: superstruct_1.integer(),
        resultIndex: superstruct_1.integer(),
    }),
];
// Generic transaction argument
exports.TransactionArgument = superstruct_1.union([...TransactionArgumentTypes]);
// Transaction argument referring to an object:
exports.ObjectTransactionArgument = superstruct_1.union([...TransactionArgumentTypes]);
exports.ObjectTransactionArgument[utils_1.TRANSACTION_TYPE] = {
    kind: 'object',
};
const PureTransactionArgument = (type) => {
    const struct = superstruct_1.union([...TransactionArgumentTypes]);
    struct[utils_1.TRANSACTION_TYPE] = {
        kind: 'pure',
        type,
    };
    return struct;
};
exports.PureTransactionArgument = PureTransactionArgument;
exports.MoveCallTransaction = superstruct_1.object({
    kind: superstruct_1.literal('MoveCall'),
    target: superstruct_1.define('target', superstruct_1.string().validator),
    typeArguments: superstruct_1.array(superstruct_1.string()),
    arguments: superstruct_1.array(exports.TransactionArgument),
});
exports.TransferObjectsTransaction = superstruct_1.object({
    kind: superstruct_1.literal('TransferObjects'),
    objects: superstruct_1.array(exports.ObjectTransactionArgument),
    address: exports.PureTransactionArgument(bcs_1.BCS.ADDRESS),
});
exports.SplitCoinsTransaction = superstruct_1.object({
    kind: superstruct_1.literal('SplitCoins'),
    coin: exports.ObjectTransactionArgument,
    amounts: superstruct_1.array(exports.PureTransactionArgument('u64')),
});
exports.MergeCoinsTransaction = superstruct_1.object({
    kind: superstruct_1.literal('MergeCoins'),
    destination: exports.ObjectTransactionArgument,
    sources: superstruct_1.array(exports.ObjectTransactionArgument),
});
exports.MakeMoveVecTransaction = superstruct_1.object({
    kind: superstruct_1.literal('MakeMoveVec'),
    type: superstruct_1.optional(option(superstruct_1.string())),
    objects: superstruct_1.array(exports.ObjectTransactionArgument),
});
exports.PublishTransaction = superstruct_1.object({
    kind: superstruct_1.literal('Publish'),
    modules: superstruct_1.array(superstruct_1.array(superstruct_1.integer())),
    dependencies: superstruct_1.array(common_1.ObjectId),
});
const TransactionTypes = [
    exports.MoveCallTransaction,
    exports.TransferObjectsTransaction,
    exports.SplitCoinsTransaction,
    exports.MergeCoinsTransaction,
    exports.PublishTransaction,
    exports.MakeMoveVecTransaction,
];
exports.TransactionType = superstruct_1.union([...TransactionTypes]);
function getTransactionType(data) {
    superstruct_1.assert(data, exports.TransactionType);
    return TransactionTypes.find((schema) => superstruct_1.is(data, schema));
}
exports.getTransactionType = getTransactionType;
/**
 * Simple helpers used to construct transactions:
 */
exports.Transactions = {
    MoveCall(input) {
        var _a, _b;
        return utils_1.create({
            kind: 'MoveCall',
            target: input.target,
            arguments: (_a = input.arguments) !== null && _a !== void 0 ? _a : [],
            typeArguments: (_b = input.typeArguments) !== null && _b !== void 0 ? _b : [],
        }, exports.MoveCallTransaction);
    },
    TransferObjects(objects, address) {
        return utils_1.create({ kind: 'TransferObjects', objects, address }, exports.TransferObjectsTransaction);
    },
    SplitCoins(coin, amounts) {
        return utils_1.create({ kind: 'SplitCoins', coin, amounts }, exports.SplitCoinsTransaction);
    },
    MergeCoins(destination, sources) {
        return utils_1.create({ kind: 'MergeCoins', destination, sources }, exports.MergeCoinsTransaction);
    },
    Publish(modules, dependencies) {
        return utils_1.create({ kind: 'Publish', modules, dependencies }, exports.PublishTransaction);
    },
    MakeMoveVec({ type, objects, }) {
        return utils_1.create({
            kind: 'MakeMoveVec',
            type: type ? { Some: type } : { None: null },
            objects,
        }, exports.MakeMoveVecTransaction);
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHJhbnNhY3Rpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9teXN0ZW5sYWIvYnVpbGRlci9UcmFuc2FjdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEscUNBQWtDO0FBQ2xDLDZDQWNxQjtBQUNyQiw0Q0FBMkM7QUFDM0MsbUNBQXNFO0FBRXRFLE1BQU0sTUFBTSxHQUFHLENBQTZCLElBQU8sRUFBRSxFQUFFLENBQ3JELG1CQUFLLENBQUMsQ0FBQyxvQkFBTSxDQUFDLEVBQUUsSUFBSSxFQUFFLHFCQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLG9CQUFNLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFdEQsUUFBQSxxQkFBcUIsR0FBRyxvQkFBTSxDQUFDO0lBQzFDLElBQUksRUFBRSxxQkFBTyxDQUFDLE9BQU8sQ0FBQztJQUN0QixLQUFLLEVBQUUscUJBQU8sRUFBRTtJQUNoQixLQUFLLEVBQUUsc0JBQVEsQ0FBQyxpQkFBRyxFQUFFLENBQUM7SUFDdEIsSUFBSSxFQUFFLHNCQUFRLENBQUMsbUJBQUssQ0FBQyxDQUFDLHFCQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUscUJBQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7Q0FDNUQsQ0FBQyxDQUFDO0FBR0gsTUFBTSx3QkFBd0IsR0FBRztJQUMvQiw2QkFBcUI7SUFDckIsb0JBQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxxQkFBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7SUFDcEMsb0JBQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxxQkFBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxxQkFBTyxFQUFFLEVBQUUsQ0FBQztJQUNyRCxvQkFBTSxDQUFDO1FBQ0wsSUFBSSxFQUFFLHFCQUFPLENBQUMsY0FBYyxDQUFDO1FBQzdCLEtBQUssRUFB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QVMsRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLEVBQUUsMEJBQWtCLENBQUMsQ0FBQztJQUNoRixDQUFDO0lBQ0QsV0FBVyxDQUFDLEVBQ1YsSUFBSSxFQUNKLE9BQU8sR0FHUjtRQUNDLE9BQU8sY0FBTSxDQUNYO1lBQ0UsSUFBSSxFQUFFLGFBQWE7WUFDbkIsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtZQUM1QyxPQUFPO1NBQ1IsRUFDRCw4QkFBc0IsQ0FDdkIsQ0FBQztJQUNKLENBQUM7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQkNTIH0gZnJvbSAnQG15c3Rlbi9iY3MnO1xuaW1wb3J0IHtcbiAgaXMsXG4gIGFueSxcbiAgYXJyYXksXG4gIEluZmVyLFxuICBpbnRlZ2VyLFxuICBsaXRlcmFsLFxuICBvYmplY3QsXG4gIG9wdGlvbmFsLFxuICBzdHJpbmcsXG4gIHVuaW9uLFxuICBhc3NlcnQsXG4gIFN0cnVjdCxcbiAgZGVmaW5lLFxufSBmcm9tICdzdXBlcnN0cnVjdCc7XG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gJy4uL3R5cGVzL2NvbW1vbic7XG5pbXBvcnQgeyBUUkFOU0FDVElPTl9UWVBFLCBXZWxsS25vd25FbmNvZGluZywgY3JlYXRlIH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IG9wdGlvbiA9IDxUIGV4dGVuZHMgU3RydWN0PGFueSwgYW55Pj4oc29tZTogVCkgPT5cbiAgdW5pb24oW29iamVjdCh7IE5vbmU6IGxpdGVyYWwobnVsbCkgfSksIG9iamVjdCh7IFNvbWU6IHNvbWUgfSldKTtcblxuZXhwb3J0IGNvbnN0IFRyYW5zYWN0aW9uQmxvY2tJbnB1dCA9IG9iamVjdCh7XG4gIGtpbmQ6IGxpdGVyYWwoJ0lucHV0JyksXG4gIGluZGV4OiBpbnRlZ2VyKCksXG4gIHZhbHVlOiBvcHRpb25hbChhbnkoKSksXG4gIHR5cGU6IG9wdGlvbmFsKHVuaW9uKFtsaXRlcmFsKCdwdXJlJyksIGxpdGVyYWwoJ29iamVjdCcpXSkpLFxufSk7XG5leHBvcnQgdHlwZSBUcmFuc2FjdGlvbkJsb2NrSW5wdXQgPSBJbmZlcjx0eXBlb2YgVHJhbnNhY3Rpb25CbG9ja0lucHV0PjtcblxuY29uc3QgVHJhbnNhY3Rpb25Bcmd1bWVudFR5cGVzID0gW1xuICBUcmFuc2FjdGlvbkJsb2NrSW5wdXQsXG4gIG9iamVjdCh7IGtpbmQ6IGxpdGVyYWwoJ0dhc0NvaW4nKSB9KSxcbiAgb2JqZWN0KHsga2luZDogbGl0ZXJhbCgnUmVzdWx0JyksIGluZGV4OiBpbnRlZ2VyKCkgfSksXG4gIG9iamVjdCh7XG4gICAga2luZDogbGl0ZXJhbCgnTmVzdGVkUmVzdWx0JyksXG4gICAgaW5kZXg6IGludGVnZXIoKSxcbiAgICByZXN1bHRJbmRleDogaW50ZWdlcigpLFxuICB9KSxcbl0gYXMgY29uc3Q7XG5cbi8vIEdlbmVyaWMgdHJhbnNhY3Rpb24gYXJndW1lbnRcbmV4cG9ydCBjb25zdCBUcmFuc2FjdGlvbkFyZ3VtZW50ID0gdW5pb24oWy4uLlRyYW5zYWN0aW9uQXJndW1lbnRUeXBlc10pO1xuZXhwb3J0IHR5cGUgVHJhbnNhY3Rpb25Bcmd1bWVudCA9IEluZmVyPHR5cGVvZiBUcmFuc2FjdGlvbkFyZ3VtZW50PjtcblxuLy8gVHJhbnNhY3Rpb24gYXJndW1lbnQgcmVmZXJyaW5nIHRvIGFuIG9iamVjdDpcbmV4cG9ydCBjb25zdCBPYmplY3RUcmFuc2FjdGlvbkFyZ3VtZW50ID0gdW5pb24oWy4uLlRyYW5zYWN0aW9uQXJndW1lbnRUeXBlc10pO1xuKE9iamVjdFRyYW5zYWN0aW9uQXJndW1lbnQgYXMgYW55KVtUUkFOU0FDVElPTl9UWVBFXSA9IHtcbiAga2luZDogJ29iamVjdCcsXG59IGFzIFdlbGxLbm93bkVuY29kaW5nO1xuXG5leHBvcnQgY29uc3QgUHVyZVRyYW5zYWN0aW9uQXJndW1lbnQgPSAodHlwZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IHN0cnVjdCA9IHVuaW9uKFsuLi5UcmFuc2FjdGlvbkFyZ3VtZW50VHlwZXNdKTtcbiAgKHN0cnVjdCBhcyBhbnkpW1RSQU5TQUNUSU9OX1RZUEVdID0ge1xuICAgIGtpbmQ6ICdwdXJlJyxcbiAgICB0eXBlLFxuICB9IGFzIFdlbGxLbm93bkVuY29kaW5nO1xuICByZXR1cm4gc3RydWN0O1xufTtcblxuZXhwb3J0IGNvbnN0IE1vdmVDYWxsVHJhbnNhY3Rpb24gPSBvYmplY3Qoe1xuICBraW5kOiBsaXRlcmFsKCdNb3ZlQ2FsbCcpLFxuICB0YXJnZXQ6IGRlZmluZTxgJHtzdHJpbmd9Ojoke3N0cmluZ306OiR7c3RyaW5nfWA+KCd0YXJnZXQnLCBzdHJpbmcoKS52YWxpZGF0b3IpLFxuICB0eXBlQXJndW1lbnRzOiBhcnJheShzdHJpbmcoKSksXG4gIGFyZ3VtZW50czogYXJyYXkoVHJhbnNhY3Rpb25Bcmd1bWVudCksXG59KTtcbmV4cG9ydCB0eXBlIE1vdmVDYWxsVHJhbnNhY3Rpb24gPSBJbmZlcjx0eXBlb2YgTW92ZUNhbGxUcmFuc2FjdGlvbj47XG5cbmV4cG9ydCBjb25zdCBUcmFuc2Zlck9iamVjdHNUcmFuc2FjdGlvbiA9IG9iamVjdCh7XG4gIGtpbmQ6IGxpdGVyYWwoJ1RyYW5zZmVyT2JqZWN0cycpLFxuICBvYmplY3RzOiBhcnJheShPYmplY3RUcmFuc2FjdGlvbkFyZ3VtZW50KSxcbiAgYWRkcmVzczogUHVyZVRyYW5zYWN0aW9uQXJndW1lbnQoQkNTLkFERFJFU1MpLFxufSk7XG5leHBvcnQgdHlwZSBUcmFuc2Zlck9iamVjdHNUcmFuc2FjdGlvbiA9IEluZmVyPHR5cGVvZiBUcmFuc2Zlck9iamVjdHNUcmFuc2FjdGlvbj47XG5cbmV4cG9ydCBjb25zdCBTcGxpdENvaW5zVHJhbnNhY3Rpb24gPSBvYmplY3Qoe1xuICBraW5kOiBsaXRlcmFsKCdTcGxpdENvaW5zJyksXG4gIGNvaW46IE9iamVjdFRyYW5zYWN0aW9uQXJndW1lbnQsXG4gIGFtb3VudHM6IGFycmF5KFB1cmVUcmFuc2FjdGlvbkFyZ3VtZW50KCd1NjQnKSksXG59KTtcbmV4cG9ydCB0eXBlIFNwbGl0Q29pbnNUcmFuc2FjdGlvbiA9IEluZmVyPHR5cGVvZiBTcGxpdENvaW5zVHJhbnNhY3Rpb24+O1xuXG5leHBvcnQgY29uc3QgTWVyZ2VDb2luc1RyYW5zYWN0aW9uID0gb2JqZWN0KHtcbiAga2luZDogbGl0ZXJhbCgnTWVyZ2VDb2lucycpLFxuICBkZXN0aW5hdGlvbjogT2JqZWN0VHJhbnNhY3Rpb25Bcmd1bWVudCxcbiAgc291cmNlczogYXJyYXkoT2JqZWN0VHJhbnNhY3Rpb25Bcmd1bWVudCksXG59KTtcbmV4cG9ydCB0eXBlIE1lcmdlQ29pbnNUcmFuc2FjdGlvbiA9IEluZmVyPHR5cGVvZiBNZXJnZUNvaW5zVHJhbnNhY3Rpb24+O1xuXG5leHBvcnQgY29uc3QgTWFrZU1vdmVWZWNUcmFuc2FjdGlvbiA9IG9iamVjdCh7XG4gIGtpbmQ6IGxpdGVyYWwoJ01ha2VNb3ZlVmVjJyksXG4gIHR5cGU6IG9wdGlvbmFsKG9wdGlvbihzdHJpbmcoKSkpLFxuICBvYmplY3RzOiBhcnJheShPYmplY3RUcmFuc2FjdGlvbkFyZ3VtZW50KSxcbn0pO1xuZXhwb3J0IHR5cGUgTWFrZU1vdmVWZWNUcmFuc2FjdGlvbiA9IEluZmVyPHR5cGVvZiBNYWtlTW92ZVZlY1RyYW5zYWN0aW9uPjtcblxuZXhwb3J0IGNvbnN0IFB1Ymxpc2hUcmFuc2FjdGlvbiA9IG9iamVjdCh7XG4gIGtpbmQ6IGxpdGVyYWwoJ1B1Ymxpc2gnKSxcbiAgbW9kdWxlczogYXJyYXkoYXJyYXkoaW50ZWdlcigpKSksXG4gIGRlcGVuZGVuY2llczogYXJyYXkoT2JqZWN0SWQpLFxufSk7XG5leHBvcnQgdHlwZSBQdWJsaXNoVHJhbnNhY3Rpb24gPSBJbmZlcjx0eXBlb2YgUHVibGlzaFRyYW5zYWN0aW9uPjtcblxuY29uc3QgVHJhbnNhY3Rpb25UeXBlcyA9IFtcbiAgTW92ZUNhbGxUcmFuc2FjdGlvbixcbiAgVHJhbnNmZXJPYmplY3RzVHJhbnNhY3Rpb24sXG4gIFNwbGl0Q29pbnNUcmFuc2FjdGlvbixcbiAgTWVyZ2VDb2luc1RyYW5zYWN0aW9uLFxuICBQdWJsaXNoVHJhbnNhY3Rpb24sXG4gIE1ha2VNb3ZlVmVjVHJhbnNhY3Rpb24sXG5dIGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgVHJhbnNhY3Rpb25UeXBlID0gdW5pb24oWy4uLlRyYW5zYWN0aW9uVHlwZXNdKTtcbmV4cG9ydCB0eXBlIFRyYW5zYWN0aW9uVHlwZSA9IEluZmVyPHR5cGVvZiBUcmFuc2FjdGlvblR5cGU+O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25UeXBlKGRhdGE6IHVua25vd24pIHtcbiAgYXNzZXJ0KGRhdGEsIFRyYW5zYWN0aW9uVHlwZSk7XG4gIHJldHVybiBUcmFuc2FjdGlvblR5cGVzLmZpbmQoKHNjaGVtYSkgPT4gaXMoZGF0YSwgc2NoZW1hIGFzIFN0cnVjdCkpITtcbn1cblxuLyoqXG4gKiBTaW1wbGUgaGVscGVycyB1c2VkIHRvIGNvbnN0cnVjdCB0cmFuc2FjdGlvbnM6XG4gKi9cbmV4cG9ydCBjb25zdCBUcmFuc2FjdGlvbnMgPSB7XG4gIE1vdmVDYWxsKFxuICAgIGlucHV0OiBPbWl0PE1vdmVDYWxsVHJhbnNhY3Rpb24sICdraW5kJyB8ICdhcmd1bWVudHMnIHwgJ3R5cGVBcmd1bWVudHMnPiAmIHtcbiAgICAgIGFyZ3VtZW50cz86IFRyYW5zYWN0aW9uQXJndW1lbnRbXTtcbiAgICAgIHR5cGVBcmd1bWVudHM/OiBzdHJpbmdbXTtcbiAgICB9XG4gICk6IE1vdmVDYWxsVHJhbnNhY3Rpb24ge1xuICAgIHJldHVybiBjcmVhdGUoXG4gICAgICB7XG4gICAgICAgIGtpbmQ6ICdNb3ZlQ2FsbCcsXG4gICAgICAgIHRhcmdldDogaW5wdXQudGFyZ2V0LFxuICAgICAgICBhcmd1bWVudHM6IGlucHV0LmFyZ3VtZW50cyA/PyBbXSxcbiAgICAgICAgdHlwZUFyZ3VtZW50czogaW5wdXQudHlwZUFyZ3VtZW50cyA/PyBbXSxcbiAgICAgIH0sXG4gICAgICBNb3ZlQ2FsbFRyYW5zYWN0aW9uXG4gICAgKTtcbiAgfSxcbiAgVHJhbnNmZXJPYmplY3RzKG9iamVjdHM6IFRyYW5zYWN0aW9uQXJndW1lbnRbXSwgYWRkcmVzczogVHJhbnNhY3Rpb25Bcmd1bWVudCk6IFRyYW5zZmVyT2JqZWN0c1RyYW5zYWN0aW9uIHtcbiAgICByZXR1cm4gY3JlYXRlKHsga2luZDogJ1RyYW5zZmVyT2JqZWN0cycsIG9iamVjdHMsIGFkZHJlc3MgfSwgVHJhbnNmZXJPYmplY3RzVHJhbnNhY3Rpb24pO1xuICB9LFxuICBTcGxpdENvaW5zKGNvaW46IFRyYW5zYWN0aW9uQXJndW1lbnQsIGFtb3VudHM6IFRyYW5zYWN0aW9uQXJndW1lbnRbXSk6IFNwbGl0Q29pbnNUcmFuc2FjdGlvbiB7XG4gICAgcmV0dXJuIGNyZWF0ZSh7IGtpbmQ6ICdTcGxpdENvaW5zJywgY29pbiwgYW1vdW50cyB9LCBTcGxpdENvaW5zVHJhbnNhY3Rpb24pO1xuICB9LFxuICBNZXJnZUNvaW5zKGRlc3RpbmF0aW9uOiBUcmFuc2FjdGlvbkFyZ3VtZW50LCBzb3VyY2VzOiBUcmFuc2FjdGlvbkFyZ3VtZW50W10pOiBNZXJnZUNvaW5zVHJhbnNhY3Rpb24ge1xuICAgIHJldHVybiBjcmVhdGUoeyBraW5kOiAnTWVyZ2VDb2lucycsIGRlc3RpbmF0aW9uLCBzb3VyY2VzIH0sIE1lcmdlQ29pbnNUcmFuc2FjdGlvbik7XG4gIH0sXG4gIFB1Ymxpc2gobW9kdWxlczogbnVtYmVyW11bXSwgZGVwZW5kZW5jaWVzOiBPYmplY3RJZFtdKTogUHVibGlzaFRyYW5zYWN0aW9uIHtcbiAgICByZXR1cm4gY3JlYXRlKHsga2luZDogJ1B1Ymxpc2gnLCBtb2R1bGVzLCBkZXBlbmRlbmNpZXMgfSwgUHVibGlzaFRyYW5zYWN0aW9uKTtcbiAgfSxcbiAgTWFrZU1vdmVWZWMoe1xuICAgIHR5cGUsXG4gICAgb2JqZWN0cyxcbiAgfTogT21pdDxNYWtlTW92ZVZlY1RyYW5zYWN0aW9uLCAna2luZCcgfCAndHlwZSc+ICYge1xuICAgIHR5cGU/OiBzdHJpbmc7XG4gIH0pOiBNYWtlTW92ZVZlY1RyYW5zYWN0aW9uIHtcbiAgICByZXR1cm4gY3JlYXRlKFxuICAgICAge1xuICAgICAgICBraW5kOiAnTWFrZU1vdmVWZWMnLFxuICAgICAgICB0eXBlOiB0eXBlID8geyBTb21lOiB0eXBlIH0gOiB7IE5vbmU6IG51bGwgfSxcbiAgICAgICAgb2JqZWN0cyxcbiAgICAgIH0sXG4gICAgICBNYWtlTW92ZVZlY1RyYW5zYWN0aW9uXG4gICAgKTtcbiAgfSxcbn07XG4iXX0=