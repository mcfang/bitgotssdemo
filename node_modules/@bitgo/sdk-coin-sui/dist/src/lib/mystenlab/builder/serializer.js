"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPureSerializationType = exports.isTxContext = void 0;
const types_1 = require("../types");
const STD_ASCII_MODULE_NAME = 'ascii';
const STD_ASCII_STRUCT_NAME = 'String';
const STD_UTF8_MODULE_NAME = 'string';
const STD_UTF8_STRUCT_NAME = 'String';
const STD_OPTION_MODULE_NAME = 'option';
const STD_OPTION_STRUCT_NAME = 'Option';
const RESOLVED_SUI_ID = {
    address: types_1.SUI_FRAMEWORK_ADDRESS,
    module: types_1.OBJECT_MODULE_NAME,
    name: types_1.ID_STRUCT_NAME,
};
const RESOLVED_ASCII_STR = {
    address: types_1.MOVE_STDLIB_ADDRESS,
    module: STD_ASCII_MODULE_NAME,
    name: STD_ASCII_STRUCT_NAME,
};
const RESOLVED_UTF8_STR = {
    address: types_1.MOVE_STDLIB_ADDRESS,
    module: STD_UTF8_MODULE_NAME,
    name: STD_UTF8_STRUCT_NAME,
};
const RESOLVED_STD_OPTION = {
    address: types_1.MOVE_STDLIB_ADDRESS,
    module: STD_OPTION_MODULE_NAME,
    name: STD_OPTION_STRUCT_NAME,
};
const isSameStruct = (a, b) => a.address === b.address && a.module === b.module && a.name === b.name;
function isTxContext(param) {
    var _a;
    const struct = (_a = types_1.extractStructTag(param)) === null || _a === void 0 ? void 0 : _a.Struct;
    return (struct === null || struct === void 0 ? void 0 : struct.address) === '0x2' && (struct === null || struct === void 0 ? void 0 : struct.module) === 'tx_context' && (struct === null || struct === void 0 ? void 0 : struct.name) === 'TxContext';
}
exports.isTxContext = isTxContext;
function expectType(typeName, argVal) {
    if (typeof argVal === 'undefined') {
        return;
    }
    if (typeof argVal !== typeName) {
        throw new Error(`Expect ${argVal} to be ${typeName}, received ${typeof argVal}`);
    }
}
const allowedTypes = ['Address', 'Bool', 'U8', 'U16', 'U32', 'U64', 'U128', 'U256'];
function getPureSerializationType(normalizedType, argVal) {
    if (typeof normalizedType === 'string' && allowedTypes.includes(normalizedType)) {
        if (normalizedType in ['U8', 'U16', 'U32', 'U64', 'U128', 'U256']) {
            expectType('number', argVal);
        }
        else if (normalizedType === 'Bool') {
            expectType('boolean', argVal);
        }
        else if (normalizedType === 'Address') {
            expectType('string', argVal);
            if (argVal && !types_1.isValidSuiAddress(argVal)) {
                throw new Error('Invalid Sui Address');
            }
        }
        return normalizedType.toLowerCase();
    }
    else if (typeof normalizedType === 'string') {
        throw new Error(`Unknown pure normalized type ${JSON.stringify(normalizedType, null, 2)}`);
    }
    if ('Vector' in normalizedType) {
        if ((argVal === undefined || typeof argVal === 'string') && normalizedType.Vector === 'U8') {
            return 'string';
        }
        if (argVal !== undefined && !Array.isArray(argVal)) {
            throw new Error(`Expect ${argVal} to be a array, received ${typeof argVal}`);
        }
        const innerType = getPureSerializationType(normalizedType.Vector, 
        // undefined when argVal is empty
        argVal ? argVal[0] : undefined);
        if (innerType === undefined) {
            return;
        }
        return `vector<${innerType}>`;
    }
    if ('Struct' in normalizedType) {
        if (isSameStruct(normalizedType.Struct, RESOLVED_ASCII_STR)) {
            return 'string';
        }
        else if (isSameStruct(normalizedType.Struct, RESOLVED_UTF8_STR)) {
            return 'utf8string';
        }
        else if (isSameStruct(normalizedType.Struct, RESOLVED_SUI_ID)) {
            return 'address';
        }
        else if (isSameStruct(normalizedType.Struct, RESOLVED_STD_OPTION)) {
            const optionToVec = {
                Vector: normalizedType.Struct.typeArguments[0],
            };
            return getPureSerializationType(optionToVec, argVal);
        }
    }
    return undefined;
}
exports.getPureSerializationType = getPureSerializationType;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VyaWFsaXplci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvbXlzdGVubGFiL2J1aWxkZXIvc2VyaWFsaXplci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxvQ0FTa0I7QUFFbEIsTUFBTSxxQkFBcUIsR0FBRyxPQUFPLENBQUM7QUFDdEMsTUFBTSxxQkFBcUIsR0FBRyxRQUFRLENBQUM7QUFFdkMsTUFBTSxvQkFBb0IsR0FBRyxRQUFRLENBQUM7QUFDdEMsTUFBTSxvQkFBb0IsR0FBRyxRQUFRLENBQUM7QUFFdEMsTUFBTSxzQkFBc0IsR0FBRyxRQUFRLENBQUM7QUFDeEMsTUFBTSxzQkFBc0IsR0FBRyxRQUFRLENBQUM7QUFFeEMsTUFBTSxlQUFlLEdBQUc7SUFDdEIsT0FBTyxFQUFFLDZCQUFxQjtJQUM5QixNQUFNLEVBQUUsMEJBQWtCO0lBQzFCLElBQUksRUFBRSxzQkFBYztDQUNyQixDQUFDO0FBQ0YsTUFBTSxrQkFBa0IsR0FBRztJQUN6QixPQUFPLEVBQUUsMkJBQW1CO0lBQzVCLE1BQU0sRUFBRSxxQkFBcUI7SUFDN0IsSUFBSSxFQUFFLHFCQUFxQjtDQUM1QixDQUFDO0FBQ0YsTUFBTSxpQkFBaUIsR0FBRztJQUN4QixPQUFPLEVBQUUsMkJBQW1CO0lBQzVCLE1BQU0sRUFBRSxvQkFBb0I7SUFDNUIsSUFBSSxFQUFFLG9CQUFvQjtDQUMzQixDQUFDO0FBRUYsTUFBTSxtQkFBbUIsR0FBRztJQUMxQixPQUFPLEVBQUUsMkJBQW1CO0lBQzVCLE1BQU0sRUFBRSxzQkFBc0I7SUFDOUIsSUFBSSxFQUFFLHNCQUFzQjtDQUM3QixDQUFDO0FBRUYsTUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFNLEVBQUUsQ0FBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxLQUFLLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsTUFBTSxJQUFJLENB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SyxTQUFTLEVBQUU7WUFDM0IsT0FBTztTQUNSO1FBRUQsT0FBTyxVQUFVLFNBQVMsR0FBRyxDQUFDO0tBQy9CO0lBRUQsSUFBSSxRQUFRLElBQUksY0FBYyxFQUFFO1FBQzlCLElBQUksWUFBWSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsa0JBQWtCLENBQUMsRUFBRTtZQUMzRCxPQUFPLFFBQVEsQ0FBQztTQUNqQjthQUFNLElBQUksWUFBWSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsaUJBQWlCLENBQUMsRUFBRTtZQUNqRSxPQUFPLFlBQVksQ0FBQztTQUNyQjthQUFNLElBQUksWUFBWSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsZUFBZSxDQUFDLEVBQUU7WUFDL0QsT0FBTyxTQUFTLENBQUM7U0FDbEI7YUFBTSxJQUFJLFlBQVksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLG1CQUFtQixDQUFDLEVBQUU7WUFDbkUsTUFBTSxXQUFXLEdBQTBCO2dCQUN6QyxNQUFNLEVBQUUsY0FBYyxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO2FBQy9DLENBQUM7WUFDRixPQUFPLHdCQUF3QixDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUN0RDtLQUNGO0lBRUQsT0FBTyxTQUFTLENBQUM7QUFDbkIsQ0FBQztBQTFERCw0REEwREMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBleHRyYWN0U3RydWN0VGFnLFxuICBJRF9TVFJVQ1RfTkFNRSxcbiAgaXNWYWxpZFN1aUFkZHJlc3MsXG4gIE1PVkVfU1RETElCX0FERFJFU1MsXG4gIE9CSkVDVF9NT0RVTEVfTkFNRSxcbiAgU3VpSnNvblZhbHVlLFxuICBTdWlNb3ZlTm9ybWFsaXplZFR5cGUsXG4gIFNVSV9GUkFNRVdPUktfQUREUkVTUyxcbn0gZnJvbSAnLi4vdHlwZXMnO1xuXG5jb25zdCBTVERfQVNDSUlfTU9EVUxFX05BTUUgPSAnYXNjaWknO1xuY29uc3QgU1REX0FTQ0lJX1NUUlVDVF9OQU1FID0gJ1N0cmluZyc7XG5cbmNvbnN0IFNURF9VVEY4X01PRFVMRV9OQU1FID0gJ3N0cmluZyc7XG5jb25zdCBTVERfVVRGOF9TVFJVQ1RfTkFNRSA9ICdTdHJpbmcnO1xuXG5jb25zdCBTVERfT1BUSU9OX01PRFVMRV9OQU1FID0gJ29wdGlvbic7XG5jb25zdCBTVERfT1BUSU9OX1NUUlVDVF9OQU1FID0gJ09wdGlvbic7XG5cbmNvbnN0IFJFU09MVkVEX1NVSV9JRCA9IHtcbiAgYWRkcmVzczogU1VJX0ZSQU1FV09SS19BRERSRVNTLFxuICBtb2R1bGU6IE9CSkVDVF9NT0RVTEVfTkFNRSxcbiAgbmFtZTogSURfU1RSVUNUX05BTUUsXG59O1xuY29uc3QgUkVTT0xWRURfQVNDSUlfU1RSID0ge1xuICBhZGRyZXNzOiBNT1ZFX1NURExJQl9BRERSRVNTLFxuICBtb2R1bGU6IFNURF9BU0NJSV9NT0RVTEVfTkFNRSxcbiAgbmFtZTogU1REX0FTQ0lJX1NUUlVDVF9OQU1FLFxufTtcbmNvbnN0IFJFU09MVkVEX1VURjhfU1RSID0ge1xuICBhZGRyZXNzOiBNT1ZFX1NURExJQl9BRERSRVNTLFxuICBtb2R1bGU6IFNURF9VVEY4X01PRFVMRV9OQU1FLFxuICBuYW1lOiBTVERfVVRGOF9TVFJVQ1RfTkFNRSxcbn07XG5cbmNvbnN0IFJFU09MVkVEX1NURF9PUFRJT04gPSB7XG4gIGFkZHJlc3M6IE1PVkVfU1RETElCX0FERFJFU1MsXG4gIG1vZHVsZTogU1REX09QVElPTl9NT0RVTEVfTkFNRSxcbiAgbmFtZTogU1REX09QVElPTl9TVFJVQ1RfTkFNRSxcbn07XG5cbmNvbnN0IGlzU2FtZVN0cnVjdCA9IChhOiBhbnksIGI6IGFueSkgPT4gYS5hZGRyZXNzID09PSBiLmFkZHJlc3MgJiYgYS5tb2R1bGUgPT09IGIubW9kdWxlICYmIGEubmFtZSA9PT0gYi5uYW1lO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNUeENvbnRleHQocGFyYW06IFN1aU1vdmVOb3JtYWxpemVkVHlwZSk6IGJvb2xlYW4ge1xuICBjb25zdCBzdHJ1Y3QgPSBleHRyYWN0U3RydWN0VGFnKHBhcmFtKT8uU3RydWN0O1xuICByZXR1cm4gc3RydWN0Py5hZGRyZXNzID09PSAnMHgyJyAmJiBzdHJ1Y3Q/Lm1vZHVsZSA9PT0gJ3R4X2NvbnRleHQnICYmIHN0cnVjdD8ubmFtZSA9PT0gJ1R4Q29udGV4dCc7XG59XG5cbmZ1bmN0aW9uIGV4cGVjdFR5cGUodHlwZU5hbWU6IHN0cmluZywgYXJnVmFsPzogU3VpSnNvblZhbHVlKSB7XG4gIGlmICh0eXBlb2YgYXJnVmFsID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAodHlwZW9mIGFyZ1ZhbCAhPT0gdHlwZU5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdCAke2FyZ1ZhbH0gdG8gYmUgJHt0eXBlTmFtZX0sIHJlY2VpdmVkICR7dHlwZW9mIGFyZ1ZhbH1gKTtcbiAgfVxufVxuXG5jb25zdCBhbGxvd2VkVHlwZXMgPSBbJ0FkZHJlc3MnLCAnQm9vbCcsICdVOCcsICdVMTYnLCAnVTMyJywgJ1U2NCcsICdVMTI4JywgJ1UyNTYnXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFB1cmVTZXJpYWxpemF0aW9uVHlwZShcbiAgbm9ybWFsaXplZFR5cGU6IFN1aU1vdmVOb3JtYWxpemVkVHlwZSxcbiAgYXJnVmFsOiBTdWlKc29uVmFsdWUgfCB1bmRlZmluZWRcbik6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gIGlmICh0eXBlb2Ygbm9ybWFsaXplZFR5cGUgPT09ICdzdHJpbmcnICYmIGFsbG93ZWRUeXBlcy5pbmNsdWRlcyhub3JtYWxpemVkVHlwZSkpIHtcbiAgICBpZiAobm9ybWFsaXplZFR5cGUgaW4gWydVOCcsICdVMTYnLCAnVTMyJywgJ1U2NCcsICdVMTI4JywgJ1UyNTYnXSkge1xuICAgICAgZXhwZWN0VHlwZSgnbnVtYmVyJywgYXJnVmFsKTtcbiAgICB9IGVsc2UgaWYgKG5vcm1hbGl6ZWRUeXBlID09PSAnQm9vbCcpIHtcbiAgICAgIGV4cGVjdFR5cGUoJ2Jvb2xlYW4nLCBhcmdWYWwpO1xuICAgIH0gZWxzZSBpZiAobm9ybWFsaXplZFR5cGUgPT09ICdBZGRyZXNzJykge1xuICAgICAgZXhwZWN0VHlwZSgnc3RyaW5nJywgYXJnVmFsKTtcbiAgICAgIGlmIChhcmdWYWwgJiYgIWlzVmFsaWRTdWlBZGRyZXNzKGFyZ1ZhbCBhcyBzdHJpbmcpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBTdWkgQWRkcmVzcycpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbm9ybWFsaXplZFR5cGUudG9Mb3dlckNhc2UoKTtcbiAgfSBlbHNlIGlmICh0eXBlb2Ygbm9ybWFsaXplZFR5cGUgPT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHB1cmUgbm9ybWFsaXplZCB0eXBlICR7SlNPTi5zdHJpbmdpZnkobm9ybWFsaXplZFR5cGUsIG51bGwsIDIpfWApO1xuICB9XG5cbiAgaWYgKCdWZWN0b3InIGluIG5vcm1hbGl6ZWRUeXBlKSB7XG4gICAgaWYgKChhcmdWYWwgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgYXJnVmFsID09PSAnc3RyaW5nJykgJiYgbm9ybWFsaXplZFR5cGUuVmVjdG9yID09PSAnVTgnKSB7XG4gICAgICByZXR1cm4gJ3N0cmluZyc7XG4gICAgfVxuXG4gICAgaWYgKGFyZ1ZhbCAhPT0gdW5kZWZpbmVkICYmICFBcnJheS5pc0FycmF5KGFyZ1ZhbCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ICR7YXJnVmFsfSB0byBiZSBhIGFycmF5LCByZWNlaXZlZCAke3R5cGVvZiBhcmdWYWx9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgaW5uZXJUeXBlID0gZ2V0UHVyZVNlcmlhbGl6YXRpb25UeXBlKFxuICAgICAgbm9ybWFsaXplZFR5cGUuVmVjdG9yLFxuICAgICAgLy8gdW5kZWZpbmVkIHdoZW4gYXJnVmFsIGlzIGVtcHR5XG4gICAgICBhcmdWYWwgPyBhcmdWYWxbMF0gOiB1bmRlZmluZWRcbiAgICApO1xuXG4gICAgaWYgKGlubmVyVHlwZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcmV0dXJuIGB2ZWN0b3I8JHtpbm5lclR5cGV9PmA7XG4gIH1cblxuICBpZiAoJ1N0cnVjdCcgaW4gbm9ybWFsaXplZFR5cGUpIHtcbiAgICBpZiAoaXNTYW1lU3RydWN0KG5vcm1hbGl6ZWRUeXBlLlN0cnVjdCwgUkVTT0xWRURfQVNDSUlfU1RSKSkge1xuICAgICAgcmV0dXJuICdzdHJpbmcnO1xuICAgIH0gZWxzZSBpZiAoaXNTYW1lU3RydWN0KG5vcm1hbGl6ZWRUeXBlLlN0cnVjdCwgUkVTT0xWRURfVVRGOF9TVFIpKSB7XG4gICAgICByZXR1cm4gJ3V0ZjhzdHJpbmcnO1xuICAgIH0gZWxzZSBpZiAoaXNTYW1lU3RydWN0KG5vcm1hbGl6ZWRUeXBlLlN0cnVjdCwgUkVTT0xWRURfU1VJX0lEKSkge1xuICAgICAgcmV0dXJuICdhZGRyZXNzJztcbiAgICB9IGVsc2UgaWYgKGlzU2FtZVN0cnVjdChub3JtYWxpemVkVHlwZS5TdHJ1Y3QsIFJFU09MVkVEX1NURF9PUFRJT04pKSB7XG4gICAgICBjb25zdCBvcHRpb25Ub1ZlYzogU3VpTW92ZU5vcm1hbGl6ZWRUeXBlID0ge1xuICAgICAgICBWZWN0b3I6IG5vcm1hbGl6ZWRUeXBlLlN0cnVjdC50eXBlQXJndW1lbnRzWzBdLFxuICAgICAgfTtcbiAgICAgIHJldHVybiBnZXRQdXJlU2VyaWFsaXphdGlvblR5cGUob3B0aW9uVG9WZWMsIGFyZ1ZhbCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cbiJdfQ==