"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const assert_1 = __importDefault(require("assert"));
require("should");
const utxoEngine_1 = require("../../../src/lib/utxoEngine");
const utils_1 = __importDefault(require("./../../../src/lib/utils"));
describe('AvaxP UTXO engine', () => {
    describe('should fail', () => {
        const sender = [
            'P-fuji103cmntssp6qnucejahddy42wcy4qty0uj42822',
            'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
            'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
        ].map((a) => utils_1.default.parseAddress(a));
        it('should return empty input for utxos of wrong type', () => {
            const utxos = [1, 2, 3, 4].map((n) => ({
                outputID: n,
                amount: '509999975',
                txid: 'CEbFa3hCDfMFu8ASZP9rT1s3X2X8wqoPAN258kkStk9JX3wsH',
                outputidx: '0',
                addresses: [
                    'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
                    'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
                    'P-fuji103cmntssp6qnucejahddy42wcy4qty0uj42822',
                ],
                threshold: 2,
            }));
            const { inputs } = utxoEngine_1.utxoToInput(utxos, sender);
            inputs.should.be.empty();
        });
        it('should fail with wrong address', () => {
            const utxos = [
                {
                    outputID: 7,
                    amount: '509999975',
                    txid: 'CEbFa3hCDfMFu8ASZP9rT1s3X2X8wqoPAN258kkStk9JX3wsH',
                    outputidx: '0',
                    addresses: [
                        'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
                        'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
                        'P-fuji13pyc89t4x5483fgdfgg9lcnpxz7ggr09vn6m6c',
                    ],
                    threshold: 2,
                },
            ];
            assert_1.default.throws(() => utxoEngine_1.utxoToInput(utxos, sender), (e) => e.message === 'Addresses are inconsistent: CEbFa3hCDfMFu8ASZP9rT1s3X2X8wqoPAN258kkStk9JX3wsH');
        });
        it('should fail with wrong threshold', () => {
            const utxos = [
                {
                    outputID: 7,
                    amount: '509999975',
                    txid: 'CEbFa3hCDfMFu8ASZP9rT1s3X2X8wqoPAN258kkStk9JX3wsH',
                    outputidx: '0',
                    addresses: [
                        'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
                        'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
                        'P-fuji103cmntssp6qnucejahddy42wcy4qty0uj42822',
                    ],
                    threshold: 3,
                },
            ];
            assert_1.default.throws(() => utxoEngine_1.utxoToInput(utxos, sender), (e) => e.message === 'Threshold is inconsistent');
        });
    });
    describe('2 of 3 signers', () => {
        const utxos = [
            {
                outputID: 7,
                amount: '509999975',
                txid: 'CEbFa3hCDfMFu8ASZP9rT1s3X2X8wqoPAN258kkStk9JX3wsH',
                outputidx: '0',
                addresses: [
                    'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
                    'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
                    'P-fuji103cmntssp6qnucejahddy42wcy4qty0uj42822',
                ],
                threshold: 2,
            },
            {
                outputID: 7,
                amount: '26932830273',
                txid: '2VyWNR4q8p7ZnKfaot37SbMBCWHbEbqEca7Af1tiRTArkJMdXt',
                outputidx: '0',
                addresses: [
                    'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
                    'P-fuji103cmntssp6qnucejahddy42wcy4qty0uj42822',
                    'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
                ],
                threshold: 2,
            },
        ];
        const sender = [
            'P-fuji103cmntssp6qnucejahddy42wcy4qty0uj42822',
            'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
            'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
        ].map((a) => utils_1.default.parseAddress(a));
        const firstSigner = sender[0].toString('hex');
        // second signer is Zeros credential.
        it('should return credential 2 of 3', () => {
            const { inputs } = utxoEngine_1.utxoToInput(utxos, sender);
            inputs.forEach((input, i) => {
                const expectedSignature = input.signatures.map((signature) => signature.toBuffer().toString('hex').substring(90));
                expectedSignature.should.containEql(firstSigner);
                const fistSignatureIdx = input.signaturesIdx[expectedSignature.indexOf(firstSigner)];
                utils_1.default.parseAddress(utxos[i].addresses[fistSignatureIdx]).toString('hex').should.be.equal(firstSigner);
            });
        });
    });
    describe('4 of 4 signers', () => {
        const utxos = [
            {
                outputID: 7,
                amount: '509999975',
                txid: 'CEbFa3hCDfMFu8ASZP9rT1s3X2X8wqoPAN258kkStk9JX3wsH',
                outputidx: '0',
                addresses: [
                    'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
                    'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
                    'P-fuji13pyc89t4x5483fgdfgg9lcnpxz7ggr09vn6m6c',
                    'P-fuji103cmntssp6qnucejahddy42wcy4qty0uj42822',
                ],
                threshold: 4,
            },
            {
                outputID: 7,
                amount: '26932830273',
                txid: '2VyWNR4q8p7ZnKfaot37SbMBCWHbEbqEca7Af1tiRTArkJMdXt',
                outputidx: '0',
                addresses: [
                    'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
                    'P-fuji13pyc89t4x5483fgdfgg9lcnpxz7ggr09vn6m6c',
                    'P-fuji103cmntssp6qnucejahddy42wcy4qty0uj42822',
                    'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
                ],
                threshold: 4,
            },
        ];
        const sender = [
            'P-fuji103cmntssp6qnucejahddy42wcy4qty0uj42822',
            'P-fuji1hdk7ntw0huhqmlhlheme9t7scsy9lhfhw3ywy4',
            'P-fuji1yzpfsdalhfwkq2ceewgs9wv7k0uft40ydpuj59',
            'P-fuji13pyc89t4x5483fgdfgg9lcnpxz7ggr09vn6m6c',
        ].map((a) => utils_1.default.parseAddress(a));
        const firstSigner = sender[0].toString('hex');
        // second signer is Zeros credential.
        const thirdSigner = sender[2].toString('hex');
        const forthSigner = sender[3].toString('hex');
        it('should return credential', () => {
            const { inputs } = utxoEngine_1.utxoToInput(utxos, sender, 4);
            inputs.forEach((input, i) => {
                const expectedSignature = input.signatures.map((signature) => signature.toBuffer().toString('hex').substring(90));
                expectedSignature.should.containEql(firstSigner);
                const fistSignatureIdx = input.signaturesIdx[expectedSignature.indexOf(firstSigner)];
                utils_1.default.parseAddress(utxos[i].addresses[fistSignatureIdx]).toString('hex').should.be.equal(firstSigner);
                expectedSignature.should.containEql(thirdSigner);
                const thirdSignatureIdx = input.signaturesIdx[expectedSignature.indexOf(thirdSigner)];
                utils_1.default.parseAddress(utxos[i].addresses[thirdSignatureIdx]).toString('hex').should.be.equal(thirdSigner);
                expectedSignature.should.containEql(forthSigner);
                const forthSignatureIdx = input.signaturesIdx[expectedSignature.indexOf(forthSigner)];
                utils_1.default.parseAddress(utxos[i].addresses[forthSignatureIdx]).toString('hex').should.be.equal(forthSigner);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXR4b0VuZ2luZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvdW5pdC9saWIvdXR4b0VuZ2luZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLG9EQUE0QjtBQUM1QixrQkFBZ0I7QUFDaEIsNERBQTBEO0FBRzFELHFFQUE2QztBQUU3QyxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO0lBQ2pDLFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQzNCLE1BQU0sTUFBTSxHQUFpQjtZQUMzQiwrQ0FBK0M7WUFDL0MsK0NBQStDO1lBQy9DLCtDQUErQztTQUNoRCxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXBDLEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxHQUFHLEVBQUU7WUFDM0QsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQ3JDLFFBQVEsRUFBRSxDQUFDO2dCQUNYLE1BQU0sRUFBRSxXQUFXO2dCQUNuQixJQUFJLEVBQUUsbURBQW1EO2dCQUN6RCxTQUFTLEVBQUUsR0FBRztnQkFDZCxTQUFTLEVBQUU7b0JBQ1QsK0NBQStDO29CQUMvQywrQ0FBK0M7b0JBQy9DLCtDQUErQztpQkFDaEQ7Z0JBQ0QsU0FBUyxFQUFFLENBQUM7YUFDYixDQUFDLENBQUMsQ0FBQztZQUNKLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyx3QkFBVyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztZQUM5QyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FB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LENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBRXRHLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ2pELE1BQU0saUJBQWlCLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztnQkFDdEYsZUFBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBRXZHLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ2pELE1BQU0saUJBQWlCLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztnQkFDdEYsZUFBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDekcsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXNzZXJ0IGZyb20gJ2Fzc2VydCc7XG5pbXBvcnQgJ3Nob3VsZCc7XG5pbXBvcnQgeyB1dHhvVG9JbnB1dCB9IGZyb20gJy4uLy4uLy4uL3NyYy9saWIvdXR4b0VuZ2luZSc7XG5pbXBvcnQgeyBEZWNvZGVkVXR4b09iaiB9IGZyb20gJy4uLy4uLy4uL3NyYy9saWInO1xuaW1wb3J0IHsgQnVmZmVyIGFzIEJ1ZmZlckF2YXggfSBmcm9tICdhdmFsYW5jaGUnO1xuaW1wb3J0IHV0aWxzIGZyb20gJy4vLi4vLi4vLi4vc3JjL2xpYi91dGlscyc7XG5cbmRlc2NyaWJlKCdBdmF4UCBVVFhPIGVuZ2luZScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ3Nob3VsZCBmYWlsJywgKCkgPT4ge1xuICAgIGNvbnN0IHNlbmRlcjogQnVmZmVyQXZheFtdID0gW1xuICAgICAgJ1AtZnVqaTEwM2NtbnRzc3A2cW51Y2VqYWhkZHk0MndjeTRxdHkwdWo0MjgyMicsXG4gICAgICAnUC1mdWppMWhkazdudHcwaHVocW1saGxoZW1lOXQ3c2NzeTlsaGZodzN5d3k0JyxcbiAgICAgICdQLWZ1amkxeXpwZnNkYWxoZndrcTJjZWV3Z3M5d3Y3azB1ZnQ0MHlkcHVqNTknLFxuICAgIF0ubWFwKChhKSA9PiB1dGlscy5wYXJzZUFkZHJlc3MoYSkpO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgaW5wdXQgZm9yIHV0eG9zIG9mIHdyb25nIHR5cGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1dHhvcyA9IFsxLCAyLCAzLCA0XS5tYXAoKG4pID0+ICh7XG4gICAgICAgIG91dHB1dElEOiBuLFxuICAgICAgICBhbW91bnQ6ICc1MDk5OTk5NzUnLFxuICAgICAgICB0eGlkOiAnQ0ViRmEzaENEZk1GdThBU1pQOXJUMXMzWDJYOHdxb1BBTjI1OGtrU3RrOUpYM3dzSCcsXG4gICAgICAgIG91dHB1dGlkeDogJzAnLFxuICAgICAgICBhZGRyZXNzZXM6IFtcbiAgICAgICAgICAnUC1mdWppMWhkazdudHcwaHVocW1saGxoZW1lOXQ3c2NzeTlsaGZodzN5d3k0JyxcbiAgICAgICAgICAnUC1mdWppMXl6cGZzZGFsaGZ3a3EyY2Vld2dzOXd2N2swdWZ0NDB5ZHB1ajU5JyxcbiAgICAgICAgICAnUC1mdWppMTAzY21udHNzcDZxbnVjZWphaGRkeTQyd2N5NHF0eTB1ajQyODIyJyxcbiAgICAgICAgXSxcbiAgICAgICAgdGhyZXNob2xkOiAyLFxuICAgICAgfSkpO1xuICAgICAgY29uc3QgeyBpbnB1dHMgfSA9IHV0eG9Ub0lucHV0KHV0eG9zLCBzZW5kZXIpO1xuICAgICAgaW5wdXRzLnNob3VsZC5iZS5lbXB0eSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHdpdGggd3JvbmcgYWRkcmVzcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHV0eG9zID0gW1xuICAgICAgICB7XG4gICAgICAgICAgb3V0cHV0SUQ6IDcsXG4gICAgICAgICAgYW1vdW50OiAnNTA5OTk5OTc1JyxcbiAgICAgICAgICB0eGlkOiAnQ0ViRmEzaENEZk1GdThBU1pQOXJUMXMzWDJYOHdxb1BBTjI1OGtrU3RrOUpYM3dzSCcsXG4gICAgICAgICAgb3V0cHV0aWR4OiAnMCcsXG4gICAgICAgICAgYWRkcmVzc2VzOiBbXG4gICAgICAgICAgICAnUC1mdWppMWhkazdudHcwaHVocW1saGxoZW1lOXQ3c2NzeTlsaGZodzN5d3k0JyxcbiAgICAgICAgICAgICdQLWZ1amkxeXpwZnNkYWxoZndrcTJjZWV3Z3M5d3Y3azB1ZnQ0MHlkcHVqNTknLFxuICAgICAgICAgICAgJ1AtZnVqaTEzcHljODl0NHg1NDgzZmdkZmdnOWxjbnB4ejdnZ3IwOXZuNm02YycsXG4gICAgICAgICAgXSxcbiAgICAgICAgICB0aHJlc2hvbGQ6IDIsXG4gICAgICAgIH0sXG4gICAgICBdO1xuICAgICAgYXNzZXJ0LnRocm93cyhcbiAgICAgICAgKCkgPT4gdXR4b1RvSW5wdXQodXR4b3MsIHNlbmRlciksXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ0FkZHJlc3NlcyBhcmUgaW5jb25zaXN0ZW50OiBDRWJGYTNoQ0RmTUZ1OEFTWlA5clQxczNYMlg4d3FvUEFOMjU4a2tTdGs5Slgzd3NIJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmFpbCB3aXRoIHdyb25nIHRocmVzaG9sZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHV0eG9zID0gW1xuICAgICAgICB7XG4gICAgICAgICAgb3V0cHV0SUQ6IDcsXG4gICAgICAgICAgYW1vdW50OiAnNTA5OTk5OTc1JyxcbiAgICAgICAgICB0eGlkOiAnQ0ViRmEzaENEZk1GdThBU1pQOXJUMXMzWDJYOHdxb1BBTjI1OGtrU3RrOUpYM3dzSCcsXG4gICAgICAgICAgb3V0cHV0aWR4OiAnMCcsXG4gICAgICAgICAgYWRkcmVzc2VzOiBbXG4gICAgICAgICAgICAnUC1mdWppMWhkazdudHcwaHVocW1saGxoZW1lOXQ3c2NzeTlsaGZodzN5d3k0JyxcbiAgICAgICAgICAgICdQLWZ1amkxeXpwZnNkYWxoZndrcTJjZWV3Z3M5d3Y3azB1ZnQ0MHlkcHVqNTknLFxuICAgICAgICAgICAgJ1AtZnVqaTEwM2NtbnRzc3A2cW51Y2VqYWhkZHk0MndjeTRxdHkwdWo0MjgyMicsXG4gICAgICAgICAgXSxcbiAgICAgICAgICB0aHJlc2hvbGQ6IDMsXG4gICAgICAgIH0sXG4gICAgICBdO1xuICAgICAgYXNzZXJ0LnRocm93cyhcbiAgICAgICAgKCkgPT4gdXR4b1RvSW5wdXQodXR4b3MsIHNlbmRlciksXG4gICAgICAgIChlOiBhbnkpID0+IGUubWVzc2FnZSA9PT0gJ1RocmVzaG9sZCBpcyBpbmNvbnNpc3RlbnQnXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnMiBvZiAzIHNpZ25lcnMnLCAoKSA9PiB7XG4gICAgY29uc3QgdXR4b3M6IERlY29kZWRVdHhvT2JqW10gPSBbXG4gICAgICB7XG4gICAgICAgIG91dHB1dElEOiA3LFxuICAgICAgICBhbW91bnQ6ICc1MDk5OTk5NzUnLFxuICAgICAgICB0eGlkOiAnQ0ViRmEzaENEZk1GdThBU1pQOXJUMXMzWDJYOHdxb1BBTjI1OGtrU3RrOUpYM3dzSCcsXG4gICAgICAgIG91dHB1dGlkeDogJzAnLFxuICAgICAgICBhZGRyZXNzZXM6IFtcbiAgICAgICAgICAnUC1mdWppMWhkazdudHcwaHVocW1saGxoZW1lOXQ3c2NzeTlsaGZodzN5d3k0JyxcbiAgICAgICAgICAnUC1mdWppMXl6cGZzZGFsaGZ3a3EyY2Vld2dzOXd2N2swdWZ0NDB5ZHB1ajU5JyxcbiAgICAgICAgICAnUC1mdWppMTAzY21udHNzcDZxbnVjZWphaGRkeTQyd2N5NHF0eTB1ajQyODIyJyxcbiAgICAgICAgXSxcbiAgICAgICAgdGhyZXNob2xkOiAyLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgb3V0cHV0SUQ6IDcsXG4gICAgICAgIGFtb3VudDogJzI2OTMyODMwMjczJyxcbiAgICAgICAgdHhpZDogJzJWeVdOUjRxOHA3Wm5LZmFvdDM3U2JNQkNXSGJFYnFFY2E3QWYxdGlSVEFya0pNZFh0JyxcbiAgICAgICAgb3V0cHV0aWR4OiAnMCcsXG4gICAgICAgIGFkZHJlc3NlczogW1xuICAgICAgICAgICdQLWZ1amkxeXpwZnNkYWxoZndrcTJjZWV3Z3M5d3Y3azB1ZnQ0MHlkcHVqNTknLFxuICAgICAgICAgICdQLWZ1amkxMDNjbW50c3NwNnFudWNlamFoZGR5NDJ3Y3k0cXR5MHVqNDI4MjInLFxuICAgICAgICAgICdQLWZ1amkxaGRrN250dzBodWhxbWxobGhlbWU5dDdzY3N5OWxoZmh3M3l3eTQnLFxuICAgICAgICBdLFxuICAgICAgICB0aHJlc2hvbGQ6IDIsXG4gICAgICB9LFxuICAgIF07XG4gICAgY29uc3Qgc2VuZGVyOiBCdWZmZXJBdmF4W10gPSBbXG4gICAgICAnUC1mdWppMTAzY21udHNzcDZxbnVjZWphaGRkeTQyd2N5NHF0eTB1ajQyODIyJyxcbiAgICAgICdQLWZ1amkxaGRrN250dzBodWhxbWxobGhlbWU5dDdzY3N5OWxoZmh3M3l3eTQnLFxuICAgICAgJ1AtZnVqaTF5enBmc2RhbGhmd2txMmNlZXdnczl3djdrMHVmdDQweWRwdWo1OScsXG4gICAgXS5tYXAoKGEpID0+IHV0aWxzLnBhcnNlQWRkcmVzcyhhKSk7XG5cbiAgICBjb25zdCBmaXJzdFNpZ25lciA9IHNlbmRlclswXS50b1N0cmluZygnaGV4Jyk7XG4gICAgLy8gc2Vjb25kIHNpZ25lciBpcyBaZXJvcyBjcmVkZW50aWFsLlxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNyZWRlbnRpYWwgMiBvZiAzJywgKCkgPT4ge1xuICAgICAgY29uc3QgeyBpbnB1dHMgfSA9IHV0eG9Ub0lucHV0KHV0eG9zLCBzZW5kZXIpO1xuICAgICAgaW5wdXRzLmZvckVhY2goKGlucHV0LCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkU2lnbmF0dXJlID0gaW5wdXQuc2lnbmF0dXJlcy5tYXAoKHNpZ25hdHVyZSkgPT5cbiAgICAgICAgICBzaWduYXR1cmUudG9CdWZmZXIoKS50b1N0cmluZygnaGV4Jykuc3Vic3RyaW5nKDkwKVxuICAgICAgICApO1xuICAgICAgICBleHBlY3RlZFNpZ25hdHVyZS5zaG91bGQuY29udGFpbkVxbChmaXJzdFNpZ25lcik7XG4gICAgICAgIGNvbnN0IGZpc3RTaWduYXR1cmVJZHggPSBpbnB1dC5zaWduYXR1cmVzSWR4W2V4cGVjdGVkU2lnbmF0dXJlLmluZGV4T2YoZmlyc3RTaWduZXIpXTtcbiAgICAgICAgdXRpbHMucGFyc2VBZGRyZXNzKHV0eG9zW2ldLmFkZHJlc3Nlc1tmaXN0U2lnbmF0dXJlSWR4XSkudG9TdHJpbmcoJ2hleCcpLnNob3VsZC5iZS5lcXVhbChmaXJzdFNpZ25lcik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJzQgb2YgNCBzaWduZXJzJywgKCkgPT4ge1xuICAgIGNvbnN0IHV0eG9zOiBEZWNvZGVkVXR4b09ialtdID0gW1xuICAgICAge1xuICAgICAgICBvdXRwdXRJRDogNyxcbiAgICAgICAgYW1vdW50OiAnNTA5OTk5OTc1JyxcbiAgICAgICAgdHhpZDogJ0NFYkZhM2hDRGZNRnU4QVNaUDlyVDFzM1gyWDh3cW9QQU4yNThra1N0azlKWDN3c0gnLFxuICAgICAgICBvdXRwdXRpZHg6ICcwJyxcbiAgICAgICAgYWRkcmVzc2VzOiBbXG4gICAgICAgICAgJ1AtZnVqaTFoZGs3bnR3MGh1aHFtbGhsaGVtZTl0N3Njc3k5bGhmaHczeXd5NCcsXG4gICAgICAgICAgJ1AtZnVqaTF5enBmc2RhbGhmd2txMmNlZXdnczl3djdrMHVmdDQweWRwdWo1OScsXG4gICAgICAgICAgJ1AtZnVqaTEzcHljODl0NHg1NDgzZmdkZmdnOWxjbnB4ejdnZ3IwOXZuNm02YycsXG4gICAgICAgICAgJ1AtZnVqaTEwM2NtbnRzc3A2cW51Y2VqYWhkZHk0MndjeTRxdHkwdWo0MjgyMicsXG4gICAgICAgIF0sXG4gICAgICAgIHRocmVzaG9sZDogNCxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG91dHB1dElEOiA3LFxuICAgICAgICBhbW91bnQ6ICcyNjkzMjgzMDI3MycsXG4gICAgICAgIHR4aWQ6ICcyVnlXTlI0cThwN1puS2Zhb3QzN1NiTUJDV0hiRWJxRWNhN0FmMXRpUlRBcmtKTWRYdCcsXG4gICAgICAgIG91dHB1dGlkeDogJzAnLFxuICAgICAgICBhZGRyZXNzZXM6IFtcbiAgICAgICAgICAnUC1mdWppMXl6cGZzZGFsaGZ3a3EyY2Vld2dzOXd2N2swdWZ0NDB5ZHB1ajU5JyxcbiAgICAgICAgICAnUC1mdWppMTNweWM4OXQ0eDU0ODNmZ2RmZ2c5bGNucHh6N2dncjA5dm42bTZjJyxcbiAgICAgICAgICAnUC1mdWppMTAzY21udHNzcDZxbnVjZWphaGRkeTQyd2N5NHF0eTB1ajQyODIyJyxcbiAgICAgICAgICAnUC1mdWppMWhkazdudHcwaHVocW1saGxoZW1lOXQ3c2NzeTlsaGZodzN5d3k0JyxcbiAgICAgICAgXSxcbiAgICAgICAgdGhyZXNob2xkOiA0LFxuICAgICAgfSxcbiAgICBdO1xuICAgIGNvbnN0IHNlbmRlcjogQnVmZmVyQXZheFtdID0gW1xuICAgICAgJ1AtZnVqaTEwM2NtbnRzc3A2cW51Y2VqYWhkZHk0MndjeTRxdHkwdWo0MjgyMicsXG4gICAgICAnUC1mdWppMWhkazdudHcwaHVocW1saGxoZW1lOXQ3c2NzeTlsaGZodzN5d3k0JyxcbiAgICAgICdQLWZ1amkxeXpwZnNkYWxoZndrcTJjZWV3Z3M5d3Y3azB1ZnQ0MHlkcHVqNTknLFxuICAgICAgJ1AtZnVqaTEzcHljODl0NHg1NDgzZmdkZmdnOWxjbnB4ejdnZ3IwOXZuNm02YycsXG4gICAgXS5tYXAoKGEpID0+IHV0aWxzLnBhcnNlQWRkcmVzcyhhKSk7XG5cbiAgICBjb25zdCBmaXJzdFNpZ25lciA9IHNlbmRlclswXS50b1N0cmluZygnaGV4Jyk7XG4gICAgLy8gc2Vjb25kIHNpZ25lciBpcyBaZXJvcyBjcmVkZW50aWFsLlxuICAgIGNvbnN0IHRoaXJkU2lnbmVyID0gc2VuZGVyWzJdLnRvU3RyaW5nKCdoZXgnKTtcbiAgICBjb25zdCBmb3J0aFNpZ25lciA9IHNlbmRlclszXS50b1N0cmluZygnaGV4Jyk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjcmVkZW50aWFsJywgKCkgPT4ge1xuICAgICAgY29uc3QgeyBpbnB1dHMgfSA9IHV0eG9Ub0lucHV0KHV0eG9zLCBzZW5kZXIsIDQpO1xuICAgICAgaW5wdXRzLmZvckVhY2goKGlucHV0LCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkU2lnbmF0dXJlID0gaW5wdXQuc2lnbmF0dXJlcy5tYXAoKHNpZ25hdHVyZSkgPT5cbiAgICAgICAgICBzaWduYXR1cmUudG9CdWZmZXIoKS50b1N0cmluZygnaGV4Jykuc3Vic3RyaW5nKDkwKVxuICAgICAgICApO1xuICAgICAgICBleHBlY3RlZFNpZ25hdHVyZS5zaG91bGQuY29udGFpbkVxbChmaXJzdFNpZ25lcik7XG4gICAgICAgIGNvbnN0IGZpc3RTaWduYXR1cmVJZHggPSBpbnB1dC5zaWduYXR1cmVzSWR4W2V4cGVjdGVkU2lnbmF0dXJlLmluZGV4T2YoZmlyc3RTaWduZXIpXTtcbiAgICAgICAgdXRpbHMucGFyc2VBZGRyZXNzKHV0eG9zW2ldLmFkZHJlc3Nlc1tmaXN0U2lnbmF0dXJlSWR4XSkudG9TdHJpbmcoJ2hleCcpLnNob3VsZC5iZS5lcXVhbChmaXJzdFNpZ25lcik7XG5cbiAgICAgICAgZXhwZWN0ZWRTaWduYXR1cmUuc2hvdWxkLmNvbnRhaW5FcWwodGhpcmRTaWduZXIpO1xuICAgICAgICBjb25zdCB0aGlyZFNpZ25hdHVyZUlkeCA9IGlucHV0LnNpZ25hdHVyZXNJZHhbZXhwZWN0ZWRTaWduYXR1cmUuaW5kZXhPZih0aGlyZFNpZ25lcildO1xuICAgICAgICB1dGlscy5wYXJzZUFkZHJlc3ModXR4b3NbaV0uYWRkcmVzc2VzW3RoaXJkU2lnbmF0dXJlSWR4XSkudG9TdHJpbmcoJ2hleCcpLnNob3VsZC5iZS5lcXVhbCh0aGlyZFNpZ25lcik7XG5cbiAgICAgICAgZXhwZWN0ZWRTaWduYXR1cmUuc2hvdWxkLmNvbnRhaW5FcWwoZm9ydGhTaWduZXIpO1xuICAgICAgICBjb25zdCBmb3J0aFNpZ25hdHVyZUlkeCA9IGlucHV0LnNpZ25hdHVyZXNJZHhbZXhwZWN0ZWRTaWduYXR1cmUuaW5kZXhPZihmb3J0aFNpZ25lcildO1xuICAgICAgICB1dGlscy5wYXJzZUFkZHJlc3ModXR4b3NbaV0uYWRkcmVzc2VzW2ZvcnRoU2lnbmF0dXJlSWR4XSkudG9TdHJpbmcoJ2hleCcpLnNob3VsZC5iZS5lcXVhbChmb3J0aFNpZ25lcik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==