"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.CodesByType = exports.CodesByPurpose = exports.CodeGroup = exports.isValid = exports.ChainType = exports.Purpose = exports.UnspentType = exports.ErrorInvalidCode = void 0;
const tcomb = __importStar(require("tcomb"));
class ErrorInvalidCode extends Error {
    constructor(code) {
        super(`invalid code ${code}`);
    }
}
exports.ErrorInvalidCode = ErrorInvalidCode;
var UnspentType;
(function (UnspentType) {
    UnspentType["p2pkh"] = "p2pkh";
    UnspentType["p2sh"] = "p2sh";
    UnspentType["p2shP2wsh"] = "p2shP2wsh";
    UnspentType["p2wpkh"] = "p2wpkh";
    UnspentType["p2wsh"] = "p2wsh";
    UnspentType["p2tr"] = "p2tr";
})(UnspentType = exports.UnspentType || (exports.UnspentType = {}));
const UnspentTypeTcomb = tcomb.enums.of(Object.keys(UnspentType));
var Purpose;
(function (Purpose) {
    Purpose["internal"] = "internal";
    Purpose["external"] = "external";
})(Purpose = exports.Purpose || (exports.Purpose = {}));
const PurposeTcomb = tcomb.enums.of(Object.keys(Purpose));
const codeList = Object.freeze([
    [0, UnspentType.p2sh, Purpose.external],
    [10, UnspentType.p2shP2wsh, Purpose.external],
    [20, UnspentType.p2wsh, Purpose.external],
    [30, UnspentType.p2tr, Purpose.external],
    [1, UnspentType.p2sh, Purpose.internal],
    [11, UnspentType.p2shP2wsh, Purpose.internal],
    [21, UnspentType.p2wsh, Purpose.internal],
    [31, UnspentType.p2tr, Purpose.internal],
].map(([id, type, purpose]) => Object.freeze({ id, type, purpose })));
exports.ChainType = tcomb.irreducible('ChainType', (n) => exports.isValid(n));
const forType = (u) => {
    // Do tcomb type checking in js projects that use this lib
    if (!UnspentTypeTcomb.is(u)) {
        throw new Error(`invalid unspent type: ${u}`);
    }
    return new CodesByPurpose(u);
};
const typeForCode = (c) => {
    const code = codeList.find(({ id }) => id === c);
    if (!code) {
        throw new ErrorInvalidCode(c);
    }
    return code.type;
};
const isValid = (c) => codeList.some(({ id }) => id === c);
exports.isValid = isValid;
const throwIfUndefined = (v) => {
    if (v === undefined) {
        throw new Error(`expected value to be defined`);
    }
    return v;
};
class CodeGroup {
    constructor(values) {
        this.values = Object.freeze([...values]);
    }
    has(code) {
        if (!exports.isValid(code)) {
            throw new ErrorInvalidCode(code);
        }
        return this.values.includes(code);
    }
}
exports.CodeGroup = CodeGroup;
class CodesByPurpose extends CodeGroup {
    constructor(t) {
        const codeMap = new Map(codeList.filter(({ type }) => type === t).map(({ purpose, id }) => [purpose, id]));
        if (codeMap.size !== 2) {
            throw new Error(`unexpected number of codes for type ${t}`);
        }
        super(codeMap.values());
        this.internal = throwIfUndefined(codeMap.get(Purpose.internal));
        this.external = throwIfUndefined(codeMap.get(Purpose.external));
    }
}
exports.CodesByPurpose = CodesByPurpose;
class CodesByType extends CodeGroup {
    constructor(p) {
        const codeMap = new Map(codeList.filter(({ purpose }) => purpose === p).map(({ type, id }) => [type, id]));
        if (codeMap.size !== 4) {
            throw new Error(`unexpected number of codes`);
        }
        super(codeMap.values());
        this.p2sh = throwIfUndefined(codeMap.get(UnspentType.p2sh));
        this.p2shP2wsh = throwIfUndefined(codeMap.get(UnspentType.p2shP2wsh));
        this.p2wsh = throwIfUndefined(codeMap.get(UnspentType.p2wsh));
        this.p2tr = throwIfUndefined(codeMap.get(UnspentType.p2tr));
    }
}
exports.CodesByType = CodesByType;
const boundHas = (instance) => instance.has.bind(instance);
const p2sh = Object.freeze(new CodesByPurpose(UnspentType.p2sh));
const p2shP2wsh = Object.freeze(new CodesByPurpose(UnspentType.p2shP2wsh));
const p2wsh = Object.freeze(new CodesByPurpose(UnspentType.p2wsh));
const p2tr = Object.freeze(new CodesByPurpose(UnspentType.p2tr));
const external = Object.freeze(new CodesByType(Purpose.external));
const internal = Object.freeze(new CodesByType(Purpose.internal));
const all = Object.freeze(codeList.map(({ id }) => id));
/** @deprecated - use utxolib.bitgo */
exports.default = Object.freeze({
    /* @deprecated: use ChainCodeTcomb */
    ChainType: exports.ChainType,
    /** @deprecated - use utxolib.bitgo */
    ChainCodeTcomb: exports.ChainType,
    /** @deprecated - use utxolib.bitgo */
    PurposeTcomb,
    /** @deprecated - use utxolib.bitgo */
    UnspentTypeTcomb,
    /** @deprecated - use utxolib.bitgo */
    p2sh,
    /** @deprecated - use utxolib.bitgo */
    p2shP2wsh,
    /** @deprecated - use utxolib.bitgo */
    p2wsh,
    /** @deprecated - use utxolib.bitgo */
    p2tr,
    /** @deprecated - use utxolib.bitgo */
    external,
    /** @deprecated - use utxolib.bitgo */
    internal,
    /** @deprecated - use utxolib.bitgo */
    all,
    /** @deprecated - use utxolib.bitgo */
    isP2sh: boundHas(p2sh),
    /** @deprecated - use utxolib.bitgo */
    isP2shP2wsh: boundHas(p2shP2wsh),
    /** @deprecated - use utxolib.bitgo */
    isP2wsh: boundHas(p2wsh),
    /** @deprecated - use utxolib.bitgo */
    isP2tr: boundHas(p2tr),
    /** @deprecated - use utxolib.bitgo */
    isExternal: boundHas(external),
    /** @deprecated - use utxolib.bitgo */
    isInternal: boundHas(internal),
    /** @deprecated - use utxolib.bitgo */
    isValid: exports.isValid,
    /** @deprecated - use utxolib.bitgo */
    forType,
    /** @deprecated - use utxolib.bitgo */
    typeForCode,
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29kZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZDQUErQjtBQUkvQixNQUFhLGdCQUFpQixTQUFRLEtBQUs7SUFDekMsWUFBWSxJQUFlO1FBQ3pCLEtBQUssQ0FBQyxnQkFBZ0IsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNoQyxDQUFDO0NBQ0Y7QUFKRCw0Q0FJQztBQUVELElBQVksV0FPWDtBQVBELFdBQVksV0FBVztJQUNyQiw4QkFBZSxDQUFBO0lBQ2YsNEJBQWEsQ0FBQTtJQUNiLHNDQUF1QixDQUFBO0lBQ3ZCLGdDQUFpQixDQUFBO0lBQ2pCLDhCQUFlLENBQUE7SUFDZiw0QkFBYSxDQUFBO0FBQ2YsQ0FBQyxFQVBXLFdBQVcsR0FBWCxtQkFBVyxLQUFYLG1CQUFXLFFBT3RCO0FBRUQsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7QUFFbEUsSUFBWSxPQUdYO0FBSEQsV0FBWSxPQUFPO0lBQ2pCLGdDQUFxQixDQUFBO0lBQ3JCLGdDQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFIVyxPQUFPLEdBQVAsZUFBTyxLQUFQLGVBQU8sUUFHbEI7QUFFRCxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFRMUQsTUFBTSxRQUFRLEdBQW1DLE1BQU0sQ0FBQyxNQUFNLENBRTFEO0lBQ0UsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsUUFBUSxDQUFDO0lBQ3ZDLENBQUMsRUFBRSxFQUFFLFdBQVcsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQztJQUM3QyxDQUFD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SUFDdEMsV0FBVztDQUNaLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHRjb21iIGZyb20gJ3Rjb21iJztcblxuZXhwb3J0IHR5cGUgQ2hhaW5Db2RlID0gbnVtYmVyO1xuXG5leHBvcnQgY2xhc3MgRXJyb3JJbnZhbGlkQ29kZSBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoY29kZTogQ2hhaW5Db2RlKSB7XG4gICAgc3VwZXIoYGludmFsaWQgY29kZSAke2NvZGV9YCk7XG4gIH1cbn1cblxuZXhwb3J0IGVudW0gVW5zcGVudFR5cGUge1xuICBwMnBraCA9ICdwMnBraCcsXG4gIHAyc2ggPSAncDJzaCcsXG4gIHAyc2hQMndzaCA9ICdwMnNoUDJ3c2gnLFxuICBwMndwa2ggPSAncDJ3cGtoJyxcbiAgcDJ3c2ggPSAncDJ3c2gnLFxuICBwMnRyID0gJ3AydHInLFxufVxuXG5jb25zdCBVbnNwZW50VHlwZVRjb21iID0gdGNvbWIuZW51bXMub2YoT2JqZWN0LmtleXMoVW5zcGVudFR5cGUpKTtcblxuZXhwb3J0IGVudW0gUHVycG9zZSB7XG4gIGludGVybmFsID0gJ2ludGVybmFsJyxcbiAgZXh0ZXJuYWwgPSAnZXh0ZXJuYWwnLFxufVxuXG5jb25zdCBQdXJwb3NlVGNvbWIgPSB0Y29tYi5lbnVtcy5vZihPYmplY3Qua2V5cyhQdXJwb3NlKSk7XG5cbmludGVyZmFjZSBJQ29kZSB7XG4gIGlkOiBDaGFpbkNvZGU7XG4gIHR5cGU6IFVuc3BlbnRUeXBlO1xuICBwdXJwb3NlOiBQdXJwb3NlO1xufVxuXG5jb25zdCBjb2RlTGlzdDogUmVhZG9ubHlBcnJheTxSZWFkb25seTxJQ29kZT4+ID0gT2JqZWN0LmZyZWV6ZShcbiAgKFxuICAgIFtcbiAgICAgIFswLCBVbnNwZW50VHlwZS5wMnNoLCBQdXJwb3NlLmV4dGVybmFsXSxcbiAgICAgIFsxMCwgVW5zcGVudFR5cGUucDJzaFAyd3NoLCBQdXJwb3NlLmV4dGVybmFsXSxcbiAgICAgIFsyMCwgVW5zcGVudFR5cGUucDJ3c2gsIFB1cnBvc2UuZXh0ZXJuYWxdLFxuICAgICAgWzMwLCBVbnNwZW50VHlwZS5wMnRyLCBQdXJwb3NlLmV4dGVybmFsXSxcblxuICAgICAgWzEsIFVuc3BlbnRUeXBlLnAyc2gsIFB1cnBvc2UuaW50ZXJuYWxdLFxuICAgICAgWzExLCBVbnNwZW50VHlwZS5wMnNoUDJ3c2gsIFB1cnBvc2UuaW50ZXJuYWxdLFxuICAgICAgWzIxLCBVbnNwZW50VHlwZS5wMndzaCwgUHVycG9zZS5pbnRlcm5hbF0sXG4gICAgICBbMzEsIFVuc3BlbnRUeXBlLnAydHIsIFB1cnBvc2UuaW50ZXJuYWxdLFxuICAgIF0gYXMgQXJyYXk8W0NoYWluQ29kZSwgVW5zcGVudFR5cGUsIFB1cnBvc2VdPlxuICApLm1hcCgoW2lkLCB0eXBlLCBwdXJwb3NlXSkgPT4gT2JqZWN0LmZyZWV6ZSh7IGlkLCB0eXBlLCBwdXJwb3NlIH0pKVxuKTtcblxuZXhwb3J0IGNvbnN0IENoYWluVHlwZSA9IHRjb21iLmlycmVkdWNpYmxlKCdDaGFpblR5cGUnLCAobikgPT4gaXNWYWxpZChuKSk7XG5cbmNvbnN0IGZvclR5cGUgPSAodTogVW5zcGVudFR5cGUpOiBDb2Rlc0J5UHVycG9zZSA9PiB7XG4gIC8vIERvIHRjb21iIHR5cGUgY2hlY2tpbmcgaW4ganMgcHJvamVjdHMgdGhhdCB1c2UgdGhpcyBsaWJcbiAgaWYgKCFVbnNwZW50VHlwZVRjb21iLmlzKHUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIHVuc3BlbnQgdHlwZTogJHt1fWApO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBDb2Rlc0J5UHVycG9zZSh1KTtcbn07XG5cbmNvbnN0IHR5cGVGb3JDb2RlID0gKGM6IENoYWluQ29kZSk6IFVuc3BlbnRUeXBlID0+IHtcbiAgY29uc3QgY29kZSA9IGNvZGVMaXN0LmZpbmQoKHsgaWQgfSkgPT4gaWQgPT09IGMpO1xuICBpZiAoIWNvZGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3JJbnZhbGlkQ29kZShjKTtcbiAgfVxuICByZXR1cm4gY29kZS50eXBlO1xufTtcblxuZXhwb3J0IGNvbnN0IGlzVmFsaWQgPSAoYzogQ2hhaW5Db2RlKTogYm9vbGVhbiA9PiBjb2RlTGlzdC5zb21lKCh7IGlkIH0pID0+IGlkID09PSBjKTtcblxuY29uc3QgdGhyb3dJZlVuZGVmaW5lZCA9IDxUPih2OiBUIHwgdW5kZWZpbmVkKTogVCA9PiB7XG4gIGlmICh2ID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYGV4cGVjdGVkIHZhbHVlIHRvIGJlIGRlZmluZWRgKTtcbiAgfVxuICByZXR1cm4gdjtcbn07XG5cbmV4cG9ydCBjbGFzcyBDb2RlR3JvdXAge1xuICBwdWJsaWMgdmFsdWVzOiBSZWFkb25seUFycmF5PENoYWluQ29kZT47XG4gIGNvbnN0cnVjdG9yKHZhbHVlczogSXRlcmFibGU8Q2hhaW5Db2RlPikge1xuICAgIHRoaXMudmFsdWVzID0gT2JqZWN0LmZyZWV6ZShbLi4udmFsdWVzXSk7XG4gIH1cblxuICBwdWJsaWMgaGFzKGNvZGU6IENoYWluQ29kZSk6IGJvb2xlYW4ge1xuICAgIGlmICghaXNWYWxpZChjb2RlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9ySW52YWxpZENvZGUoY29kZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnZhbHVlcy5pbmNsdWRlcyhjb2RlKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29kZXNCeVB1cnBvc2UgZXh0ZW5kcyBDb2RlR3JvdXAge1xuICBwdWJsaWMgaW50ZXJuYWw6IENoYWluQ29kZTtcbiAgcHVibGljIGV4dGVybmFsOiBDaGFpbkNvZGU7XG5cbiAgY29uc3RydWN0b3IodDogVW5zcGVudFR5cGUpIHtcbiAgICBjb25zdCBjb2RlTWFwOiBNYXA8UHVycG9zZSwgQ2hhaW5Db2RlPiA9IG5ldyBNYXAoXG4gICAgICBjb2RlTGlzdC5maWx0ZXIoKHsgdHlwZSB9KSA9PiB0eXBlID09PSB0KS5tYXAoKHsgcHVycG9zZSwgaWQgfSk6IFtQdXJwb3NlLCBDaGFpbkNvZGVdID0+IFtwdXJwb3NlLCBpZF0pXG4gICAgKTtcbiAgICBpZiAoY29kZU1hcC5zaXplICE9PSAyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYHVuZXhwZWN0ZWQgbnVtYmVyIG9mIGNvZGVzIGZvciB0eXBlICR7dH1gKTtcbiAgICB9XG5cbiAgICBzdXBlcihjb2RlTWFwLnZhbHVlcygpKTtcblxuICAgIHRoaXMuaW50ZXJuYWwgPSB0aHJvd0lmVW5kZWZpbmVkKGNvZGVNYXAuZ2V0KFB1cnBvc2UuaW50ZXJuYWwpKTtcbiAgICB0aGlzLmV4dGVybmFsID0gdGhyb3dJZlVuZGVmaW5lZChjb2RlTWFwLmdldChQdXJwb3NlLmV4dGVybmFsKSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvZGVzQnlUeXBlIGV4dGVuZHMgQ29kZUdyb3VwIHtcbiAgcHVibGljIHAyc2g6IENoYWluQ29kZTtcbiAgcHVibGljIHAyc2hQMndzaDogQ2hhaW5Db2RlO1xuICBwdWJsaWMgcDJ3c2g6IENoYWluQ29kZTtcbiAgcHVibGljIHAydHI6IENoYWluQ29kZTtcblxuICBjb25zdHJ1Y3RvcihwOiBQdXJwb3NlKSB7XG4gICAgY29uc3QgY29kZU1hcDogTWFwPFVuc3BlbnRUeXBlLCBDaGFpbkNvZGU+ID0gbmV3IE1hcChcbiAgICAgIGNvZGVMaXN0LmZpbHRlcigoeyBwdXJwb3NlIH0pID0+IHB1cnBvc2UgPT09IHApLm1hcCgoeyB0eXBlLCBpZCB9KTogW1Vuc3BlbnRUeXBlLCBDaGFpbkNvZGVdID0+IFt0eXBlLCBpZF0pXG4gICAgKTtcbiAgICBpZiAoY29kZU1hcC5zaXplICE9PSA0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYHVuZXhwZWN0ZWQgbnVtYmVyIG9mIGNvZGVzYCk7XG4gICAgfVxuXG4gICAgc3VwZXIoY29kZU1hcC52YWx1ZXMoKSk7XG5cbiAgICB0aGlzLnAyc2ggPSB0aHJvd0lmVW5kZWZpbmVkKGNvZGVNYXAuZ2V0KFVuc3BlbnRUeXBlLnAyc2gpKTtcbiAgICB0aGlzLnAyc2hQMndzaCA9IHRocm93SWZVbmRlZmluZWQoY29kZU1hcC5nZXQoVW5zcGVudFR5cGUucDJzaFAyd3NoKSk7XG4gICAgdGhpcy5wMndzaCA9IHRocm93SWZVbmRlZmluZWQoY29kZU1hcC5nZXQoVW5zcGVudFR5cGUucDJ3c2gpKTtcbiAgICB0aGlzLnAydHIgPSB0aHJvd0lmVW5kZWZpbmVkKGNvZGVNYXAuZ2V0KFVuc3BlbnRUeXBlLnAydHIpKTtcbiAgfVxufVxuXG5jb25zdCBib3VuZEhhcyA9IChpbnN0YW5jZTogQ29kZUdyb3VwKSA9PiBpbnN0YW5jZS5oYXMuYmluZChpbnN0YW5jZSk7XG5cbmNvbnN0IHAyc2ggPSBPYmplY3QuZnJlZXplKG5ldyBDb2Rlc0J5UHVycG9zZShVbnNwZW50VHlwZS5wMnNoKSk7XG5jb25zdCBwMnNoUDJ3c2ggPSBPYmplY3QuZnJlZXplKG5ldyBDb2Rlc0J5UHVycG9zZShVbnNwZW50VHlwZS5wMnNoUDJ3c2gpKTtcbmNvbnN0IHAyd3NoID0gT2JqZWN0LmZyZWV6ZShuZXcgQ29kZXNCeVB1cnBvc2UoVW5zcGVudFR5cGUucDJ3c2gpKTtcbmNvbnN0IHAydHIgPSBPYmplY3QuZnJlZXplKG5ldyBDb2Rlc0J5UHVycG9zZShVbnNwZW50VHlwZS5wMnRyKSk7XG5jb25zdCBleHRlcm5hbCA9IE9iamVjdC5mcmVlemUobmV3IENvZGVzQnlUeXBlKFB1cnBvc2UuZXh0ZXJuYWwpKTtcbmNvbnN0IGludGVybmFsID0gT2JqZWN0LmZyZWV6ZShuZXcgQ29kZXNCeVR5cGUoUHVycG9zZS5pbnRlcm5hbCkpO1xuY29uc3QgYWxsID0gT2JqZWN0LmZyZWV6ZShjb2RlTGlzdC5tYXAoKHsgaWQgfSkgPT4gaWQpKTtcblxuLyoqIEBkZXByZWNhdGVkIC0gdXNlIHV0eG9saWIuYml0Z28gKi9cbmV4cG9ydCBkZWZhdWx0IE9iamVjdC5mcmVlemUoe1xuICAvKiBAZGVwcmVjYXRlZDogdXNlIENoYWluQ29kZVRjb21iICovXG4gIENoYWluVHlwZSxcbiAgLyoqIEBkZXByZWNhdGVkIC0gdXNlIHV0eG9saWIuYml0Z28gKi9cbiAgQ2hhaW5Db2RlVGNvbWI6IENoYWluVHlwZSxcbiAgLyoqIEBkZXByZWNhdGVkIC0gdXNlIHV0eG9saWIuYml0Z28gKi9cbiAgUHVycG9zZVRjb21iLFxuICAvKiogQGRlcHJlY2F0ZWQgLSB1c2UgdXR4b2xpYi5iaXRnbyAqL1xuICBVbnNwZW50VHlwZVRjb21iLFxuICAvKiogQGRlcHJlY2F0ZWQgLSB1c2UgdXR4b2xpYi5iaXRnbyAqL1xuICBwMnNoLFxuICAvKiogQGRlcHJlY2F0ZWQgLSB1c2UgdXR4b2xpYi5iaXRnbyAqL1xuICBwMnNoUDJ3c2gsXG4gIC8qKiBAZGVwcmVjYXRlZCAtIHVzZSB1dHhvbGliLmJpdGdvICovXG4gIHAyd3NoLFxuICAvKiogQGRlcHJlY2F0ZWQgLSB1c2UgdXR4b2xpYi5iaXRnbyAqL1xuICBwMnRyLFxuICAvKiogQGRlcHJlY2F0ZWQgLSB1c2UgdXR4b2xpYi5iaXRnbyAqL1xuICBleHRlcm5hbCxcbiAgLyoqIEBkZXByZWNhdGVkIC0gdXNlIHV0eG9saWIuYml0Z28gKi9cbiAgaW50ZXJuYWwsXG4gIC8qKiBAZGVwcmVjYXRlZCAtIHVzZSB1dHhvbGliLmJpdGdvICovXG4gIGFsbCxcbiAgLyoqIEBkZXByZWNhdGVkIC0gdXNlIHV0eG9saWIuYml0Z28gKi9cbiAgaXNQMnNoOiBib3VuZEhhcyhwMnNoKSxcbiAgLyoqIEBkZXByZWNhdGVkIC0gdXNlIHV0eG9saWIuYml0Z28gKi9cbiAgaXNQMnNoUDJ3c2g6IGJvdW5kSGFzKHAyc2hQMndzaCksXG4gIC8qKiBAZGVwcmVjYXRlZCAtIHVzZSB1dHhvbGliLmJpdGdvICovXG4gIGlzUDJ3c2g6IGJvdW5kSGFzKHAyd3NoKSxcbiAgLyoqIEBkZXByZWNhdGVkIC0gdXNlIHV0eG9saWIuYml0Z28gKi9cbiAgaXNQMnRyOiBib3VuZEhhcyhwMnRyKSxcbiAgLyoqIEBkZXByZWNhdGVkIC0gdXNlIHV0eG9saWIuYml0Z28gKi9cbiAgaXNFeHRlcm5hbDogYm91bmRIYXMoZXh0ZXJuYWwpLFxuICAvKiogQGRlcHJlY2F0ZWQgLSB1c2UgdXR4b2xpYi5iaXRnbyAqL1xuICBpc0ludGVybmFsOiBib3VuZEhhcyhpbnRlcm5hbCksXG4gIC8qKiBAZGVwcmVjYXRlZCAtIHVzZSB1dHhvbGliLmJpdGdvICovXG4gIGlzVmFsaWQsXG4gIC8qKiBAZGVwcmVjYXRlZCAtIHVzZSB1dHhvbGliLmJpdGdvICovXG4gIGZvclR5cGUsXG4gIC8qKiBAZGVwcmVjYXRlZCAtIHVzZSB1dHhvbGliLmJpdGdvICovXG4gIHR5cGVGb3JDb2RlLFxufSk7XG4iXX0=