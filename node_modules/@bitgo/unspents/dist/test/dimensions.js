"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable @typescript-eslint/ban-ts-comment */
const should = __importStar(require("should"));
const utxo_lib_1 = require("@bitgo/utxo-lib");
const { chainCodes, chainCodesP2sh, chainCodesP2shP2wsh, chainCodesP2tr, chainCodesP2trMusig2, chainCodesP2wsh } = utxo_lib_1.bitgo;
const src_1 = require("../src");
const testutils_1 = require("./testutils");
describe('Dimensions Attributes', function () {
    it('has read-only nInputs and nOutputs', function () {
        should.throws(() => (src_1.Dimensions.ZERO.nInputs = 1), /read-only/);
        should.throws(() => (src_1.Dimensions.ZERO.nOutputs = 1), /read-only/);
    });
});
describe('Output Dimensions', function () {
    it('instantiates', function () {
        const dims = new src_1.OutputDimensions({ size: 0, count: 0 });
        should.throws(() => (dims.count += 1));
    });
});
describe('Dimensions Arithmetic', function () {
    it('sums correctly', function () {
        src_1.Dimensions.zero()
            .plus({ nP2shInputs: 1 })
            .should.eql(new src_1.Dimensions({
            nP2shInputs: 1,
            nP2shP2wshInputs: 0,
            nP2wshInputs: 0,
            nP2trKeypathInputs: 0,
            nP2trScriptPathLevel1Inputs: 0,
            nP2trScriptPathLevel2Inputs: 0,
            nP2shP2pkInputs: 0,
            outputs: { size: 0, count: 0 },
        }));
        const components = [
            { nP2shInputs: 1 },
            { nP2shP2wshInputs: 2 },
            { nP2wshInputs: 3 },
            { nP2trKeypathInputs: 4 },
            { nP2trScriptPathLevel1Inputs: 5 },
            { nP2trScriptPathLevel2Inputs: 6 },
            { outputs: { size: 23, count: 1 } },
            { outputs: { size: 44, count: 2 } },
            { outputs: { size: 0, count: 0 } },
        ];
        components.forEach((component) => should.doesNotThrow(() => src_1.Dimensions.sum(component)));
        const sum = components.reduce((a, b) => a.plus(b), src_1.Dimensions.zero());
        sum.should.eql(src_1.Dimensions.sum(...components));
        sum.should.eql(new src_1.Dimensions({
            nP2shInputs: 1,
            nP2shP2wshInputs: 2,
            nP2wshInputs: 3,
            nP2trKeypathInputs: 4,
            nP2trScriptPathLevel1Inputs: 5,
            nP2trScriptPathLevel2Inputs: 6,
            nP2shP2pkInputs: 0,
            outputs: { size: 67, count: 3 },
        }));
        sum.nOutputs.should.eql(sum.outputs.count);
    });
    it('provides some typical output sizes', function () {
        [
            [src_1.Dimensions.SingleOutput.p2sh, src_1.VirtualSizes.txP2shOutputSize],
            [src_1.Dimensions.SingleOutput.p2shP2wsh, src_1.VirtualSizes.txP2shP2wshOutputSize],
            [src_1.Dimensions.SingleOutput.p2wsh, src_1.VirtualSizes.txP2wshOutputSize],
            [src_1.Dimensions.SingleOutput.p2pkh, src_1.VirtualSizes.txP2pkhOutputSize],
            [src_1.Dimensions.SingleOutput.p2wpkh, src_1.VirtualSizes.txP2wpkhOutputSize],
            [src_1.Dimensions.SingleOutput.p2tr, src_1.VirtualSizes.txP2trOutputSize],
        ].forEach(([dims, size]) => {
            dims.getOutputsVSize().should.eql(size);
        });
    });
    it('prevents sum of invalid data', function () {
        should.doesNotThrow(() => src_1.Dimensions.sum({ outputs: { count: 0, size: 0 } }));
        should.doesNotThrow(() => src_1.Dimensions.sum({ outputs: { count: 1, size: 1 } }));
        should.throws(() => src_1.Dimensions.sum({ nOutputs: 1 }));
        should.throws(() => src_1.Dimensions.sum({ nOutputs: 1, outputs: { count: 2, size: 1 } }));
        // @ts-ignore
        should.throws(() => src_1.Dimensions.sum({ nP2shInputs: 1 }, { nP2shInputs: 'foo' }));
        should.throws(() => src_1.Dimensions.sum({ outputs: { count: 1, size: 0 } }));
        should.throws(() => src_1.Dimensions.sum({ outputs: { count: 0, size: 1 } }));
        should.throws(() => src_1.Dimensions.sum({ outputs: { count: 1, size: 1 } }, { outputs: { count: 1, size: 0 } }));
    });
    it('counts inputs correctly', function () {
        Object.entries(src_1.Dimensions.SingleInput).forEach(([key, value]) => {
            value.nInputs.should.eql(1, key);
        });
    });
    it('multiplies correctly', function () {
        const d = new src_1.Dimensions({
            nP2shInputs: 1,
            nP2shP2wshInputs: 2,
            nP2wshInputs: 3,
            nP2trKeypathInputs: 4,
            nP2trScriptPathLevel1Inputs: 5,
            nP2trScriptPathLevel2Inputs: 6,
            nP2shP2pkInputs: 7,
            outputs: { count: 1, size: 22 },
        }).times(3);
        d.should.eql(new src_1.Dimensions({
            nP2shInputs: 3,
            nP2shP2wshInputs: 6,
            nP2wshInputs: 9,
            nP2trKeypathInputs: 12,
            nP2trScriptPathLevel1Inputs: 15,
            nP2trScriptPathLevel2Inputs: 18,
            nP2shP2pkInputs: 21,
            outputs: { count: 3, size: 66 },
        }));
        d.getNInputs().should.eql(84);
        d.nInputs.should.eql(84);
    });
});
describe('Dimensions from unspent types', function () {
    it('determines unspent size according to chain', function () {
        chainCodesP2sh.forEach((chain) => src_1.Dimensions.fromUnspent({ chain }).should.eql(src_1.Dimensions.sum({ nP2shInputs: 1 })));
        chainCodesP2shP2wsh.forEach((chain) => src_1.Dimensions.fromUnspent({ chain }).should.eql(src_1.Dimensions.sum({ nP2shP2wshInputs: 1 })));
        chainCodesP2wsh.forEach((chain) => src_1.Dimensions.fromUnspent({ chain }).should.eql(src_1.Dimensions.sum({ nP2wshInputs: 1 })));
        chainCodesP2tr.forEach((chain) => {
            src_1.Dimensions.fromUnspent({ chain }).should.eql(src_1.Dimensions.sum({ nP2trScriptPathLevel1Inputs: 1 }));
            src_1.Dimensions.fromUnspent({ chain }, { p2tr: { scriptPathLevel: 2 }, p2trMusig2: { scriptPathLevel: undefined } }).should.eql(src_1.Dimensions.sum({ nP2trScriptPathLevel2Inputs: 1 }));
        });
        chainCodesP2trMusig2.forEach((chain) => {
            src_1.Dimensions.fromUnspent({ chain }).should.eql(src_1.Dimensions.sum({ nP2trScriptPathLevel1Inputs: 1 }));
            src_1.Dimensions.fromUnspent({ chain }, { p2tr: { scriptPathLevel: undefined }, p2trMusig2: { scriptPathLevel: undefined } }).should.eql(src_1.Dimensions.sum({ nP2trKeypathInputs: 1 }));
        });
        src_1.Dimensions.fromUnspents(chainCodes.map((chain) => ({ chain }))).should.eql(new src_1.Dimensions({
            nP2shP2wshInputs: 2,
            nP2shInputs: 2,
            nP2wshInputs: 2,
            nP2trKeypathInputs: 0,
            nP2trScriptPathLevel1Inputs: 4,
            nP2trScriptPathLevel2Inputs: 0,
            nP2shP2pkInputs: 0,
            outputs: { count: 0, size: 0 },
        }));
    });
    it('calculates output dimensions dynamically', function () {
        const expectedSizes = new Map([
            [testutils_1.UnspentTypeScript2of3.p2sh, src_1.VirtualSizes.txP2shOutputSize],
            [testutils_1.UnspentTypeScript2of3.p2shP2wsh, src_1.VirtualSizes.txP2shP2wshOutputSize],
            [testutils_1.UnspentTypeScript2of3.p2wsh, src_1.VirtualSizes.txP2wshOutputSize],
            [testutils_1.UnspentTypeScript2of3.p2tr, src_1.VirtualSizes.txP2trOutputSize],
            [testutils_1.UnspentTypeScript2of3.p2trMusig2, src_1.VirtualSizes.txP2trOutputSize],
            [testutils_1.UnspentTypeScript2of3.taprootKeyPathSpend, src_1.VirtualSizes.txP2trOutputSize],
            [testutils_1.UnspentTypePubKeyHash.p2pkh, src_1.VirtualSizes.txP2pkhOutputSize],
            [testutils_1.UnspentTypePubKeyHash.p2wpkh, src_1.VirtualSizes.txP2wpkhOutputSize],
        ]);
        [...Object.keys(testutils_1.UnspentTypeScript2of3), ...Object.keys(testutils_1.UnspentTypePubKeyHash)].forEach((type) => testutils_1.getOutputDimensionsForUnspentType(type).outputs.size.should.eql(expectedSizes.get(type)));
    });
});
describe('Dimensions estimates', function () {
    it('calculates vsizes', function () {
        function dim(nP2shInputs, nP2shP2wshInputs, nP2wshInputs, nOutputs) {
            return src_1.Dimensions.sum({
                nP2shInputs,
                nP2shP2wshInputs,
                nP2wshInputs,
            }, testutils_1.getOutputDimensionsForUnspentType(testutils_1.UnspentTypePubKeyHash.p2pkh).times(nOutputs));
        }
        function dimP2tr(nP2trKeypathInputs, nP2trScriptPathLevel1Inputs, nP2trScriptPathLevel2Inputs, nOutputs) {
            return src_1.Dimensions.sum({
                nP2trKeypathInputs,
                nP2trScriptPathLevel1Inputs,
                nP2trScriptPathLevel2Inputs,
            }, testutils_1.getOutputDimensionsForUnspentType(testutils_1.UnspentTypePubKeyHash.p2pkh).times(nOutputs));
        }
        const vectors = [
            [dim(1, 0, 0, 1), [false, 10, 298, 34, 342]],
            [dim(0, 1, 0, 1), [true, 11, 140, 34, 185]],
            [dim(0, 0, 1, 1), [true, 11, 105, 34, 150]],
            [dim(2, 0, 0, 1), [false, 10, 596, 34, 640]],
            [dim(0, 2, 0, 1), [true, 11, 280, 34, 325]],
            [dim(0, 0, 2, 1), [true, 11, 210, 34, 255]],
            [dim(1, 1, 1, 1), [true, 11, 543, 34, 588]],
            [dim(1, 1, 1, 2), [true, 11, 543, 68, 622]],
            [dimP2tr(1, 0, 0, 1), [true, 11, 58, 34, 103]],
            [dimP2tr(0, 1, 0, 1), [true, 11, 108, 34, 153]],
            [dimP2tr(0, 0, 1, 1), [true, 11, 116, 34, 161]],
        ];
        vectors.forEach(([dimensions, props]) => {
            [
                dimensions.isSegwit(),
                dimensions.getOverheadVSize(),
                dimensions.getInputsVSize(),
                dimensions.getOutputsVSize(),
                dimensions.getVSize(),
            ].should.eql(props);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGltZW5zaW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QvZGltZW5zaW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxzREFBc0Q7QUFDdEQsK0NBQWlDO0FBQ2pDLDhDQUF3QztBQUN4QyxNQUFNLEVBQUUsVUFBVSxFQUFFLGNBQWMsRUFBRSxtQkFBbUIsRUFBRSxjQUFjLEVBQUUsb0JBQW9CLEVBQUUsZUFBZSxFQUFFLEdBQzlHLGdCQUFLLENBQUM7QUFDUixnQ0FBb0U7QUFFcEUsMkNBQThHO0FBRTlHLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRTtJQUNoQyxFQUFFLENBQUMsb0NBQW9DLEVBQUU7UUFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFFLGdCQUFVLENBQUMsSUFBWSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUN6RSxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUUsZ0JBQVUsQ0FBQyxJQUFZLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQzVFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsbUJBQW1CLEVBQUU7SUFDNUIsRUFBRSxDQUFDLGNBQWMsRUFBRTtRQUNqQixNQUFNLElBQUksR0FBRyxJQUFJLHNCQUFnQixDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN6RCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsdUJBQXVC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LEdBQUcsQ0FBQyxDQUFDO1lBQzVDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQzNDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQzNDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQzNDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBRTNDLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQzlDLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQy9DLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ2hELENBQUM7UUFFRixPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRTtZQUN0QztnQkFDRSxVQUFVLENBQUMsUUFBUSxFQUFFO2dCQUNyQixVQUFVLENBQUMsZ0JBQWdCLEVBQUU7Z0JBQzdCLFVBQVUsQ0FBQyxjQUFjLEVBQUU7Z0JBQzNCLFVBQVUsQ0FBQyxlQUFlLEVBQUU7Z0JBQzVCLFVBQVUsQ0FBQyxRQUFRLEVBQUU7YUFDdEIsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudCAqL1xuaW1wb3J0ICogYXMgc2hvdWxkIGZyb20gJ3Nob3VsZCc7XG5pbXBvcnQgeyBiaXRnbyB9IGZyb20gJ0BiaXRnby91dHhvLWxpYic7XG5jb25zdCB7IGNoYWluQ29kZXMsIGNoYWluQ29kZXNQMnNoLCBjaGFpbkNvZGVzUDJzaFAyd3NoLCBjaGFpbkNvZGVzUDJ0ciwgY2hhaW5Db2Rlc1AydHJNdXNpZzIsIGNoYWluQ29kZXNQMndzaCB9ID1cbiAgYml0Z287XG5pbXBvcnQgeyBEaW1lbnNpb25zLCBPdXRwdXREaW1lbnNpb25zLCBWaXJ0dWFsU2l6ZXMgfSBmcm9tICcuLi9zcmMnO1xuXG5pbXBvcnQgeyBnZXRPdXRwdXREaW1lbnNpb25zRm9yVW5zcGVudFR5cGUsIFVuc3BlbnRUeXBlUHViS2V5SGFzaCwgVW5zcGVudFR5cGVTY3JpcHQyb2YzIH0gZnJvbSAnLi90ZXN0dXRpbHMnO1xuXG5kZXNjcmliZSgnRGltZW5zaW9ucyBBdHRyaWJ1dGVzJywgZnVuY3Rpb24gKCkge1xuICBpdCgnaGFzIHJlYWQtb25seSBuSW5wdXRzIGFuZCBuT3V0cHV0cycsIGZ1bmN0aW9uICgpIHtcbiAgICBzaG91bGQudGhyb3dzKCgpID0+ICgoRGltZW5zaW9ucy5aRVJPIGFzIGFueSkubklucHV0cyA9IDEpLCAvcmVhZC1vbmx5Lyk7XG4gICAgc2hvdWxkLnRocm93cygoKSA9PiAoKERpbWVuc2lvbnMuWkVSTyBhcyBhbnkpLm5PdXRwdXRzID0gMSksIC9yZWFkLW9ubHkvKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ091dHB1dCBEaW1lbnNpb25zJywgZnVuY3Rpb24gKCkge1xuICBpdCgnaW5zdGFudGlhdGVzJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGRpbXMgPSBuZXcgT3V0cHV0RGltZW5zaW9ucyh7IHNpemU6IDAsIGNvdW50OiAwIH0pO1xuICAgIHNob3VsZC50aHJvd3MoKCkgPT4gKGRpbXMuY291bnQgKz0gMSkpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnRGltZW5zaW9ucyBBcml0aG1ldGljJywgZnVuY3Rpb24gKCkge1xuICBpdCgnc3VtcyBjb3JyZWN0bHknLCBmdW5jdGlvbiAoKSB7XG4gICAgRGltZW5zaW9ucy56ZXJvKClcbiAgICAgIC5wbHVzKHsgblAyc2hJbnB1dHM6IDEgfSlcbiAgICAgIC5zaG91bGQuZXFsKFxuICAgICAgICBuZXcgRGltZW5zaW9ucyh7XG4gICAgICAgICAgblAyc2hJbnB1dHM6IDEsXG4gICAgICAgICAgblAyc2hQMndzaElucHV0czogMCxcbiAgICAgICAgICBuUDJ3c2hJbnB1dHM6IDAsXG4gICAgICAgICAgblAydHJLZXlwYXRoSW5wdXRzOiAwLFxuICAgICAgICAgIG5QMnRyU2NyaXB0UGF0aExldmVsMUlucHV0czogMCxcbiAgICAgICAgICBuUDJ0clNjcmlwdFBhdGhMZXZlbDJJbnB1dHM6IDAsXG4gICAgICAgICAgblAyc2hQMnBrSW5wdXRzOiAwLFxuICAgICAgICAgIG91dHB1dHM6IHsgc2l6ZTogMCwgY291bnQ6IDAgfSxcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBjb25zdCBjb21wb25lbnRzID0gW1xuICAgICAgeyBuUDJzaElucHV0czogMSB9LFxuICAgICAgeyBuUDJzaFAyd3NoSW5wdXRzOiAyIH0sXG4gICAgICB7IG5QMndzaElucHV0czogMyB9LFxuICAgICAgeyBuUDJ0cktleXBhdGhJbnB1dHM6IDQgfSxcbiAgICAgIHsgblAydHJTY3JpcHRQYXRoTGV2ZWwxSW5wdXRzOiA1IH0sXG4gICAgICB7IG5QMnRyU2NyaXB0UGF0aExldmVsMklucHV0czogNiB9LFxuICAgICAgeyBvdXRwdXRzOiB7IHNpemU6IDIzLCBjb3VudDogMSB9IH0sXG4gICAgICB7IG91dHB1dHM6IHsgc2l6ZTogNDQsIGNvdW50OiAyIH0gfSxcbiAgICAgIHsgb3V0cHV0czogeyBzaXplOiAwLCBjb3VudDogMCB9IH0sXG4gICAgXTtcblxuICAgIGNvbXBvbmVudHMuZm9yRWFjaCgoY29tcG9uZW50KSA9PiBzaG91bGQuZG9lc05vdFRocm93KCgpID0+IERpbWVuc2lvbnMuc3VtKGNvbXBvbmVudCkpKTtcblxuICAgIGNvbnN0IHN1bSA9IGNvbXBvbmVudHMucmVkdWNlKChhLCBiKSA9PiBhLnBsdXMoYiksIERpbWVuc2lvbnMuemVybygpKTtcblxuICAgIHN1bS5zaG91bGQuZXFsKERpbWVuc2lvbnMuc3VtKC4uLmNvbXBvbmVudHMpKTtcblxuICAgIHN1bS5zaG91bGQuZXFsKFxuICAgICAgbmV3IERpbWVuc2lvbnMoe1xuICAgICAgICBuUDJzaElucHV0czogMSxcbiAgICAgICAgblAyc2hQMndzaElucHV0czogMixcbiAgICAgICAgblAyd3NoSW5wdXRzOiAzLFxuICAgICAgICBuUDJ0cktleXBhdGhJbnB1dHM6IDQsXG4gICAgICAgIG5QMnRyU2NyaXB0UGF0aExldmVsMUlucHV0czogNSxcbiAgICAgICAgblAydHJTY3JpcHRQYXRoTGV2ZWwySW5wdXRzOiA2LFxuICAgICAgICBuUDJzaFAycGtJbnB1dHM6IDAsXG4gICAgICAgIG91dHB1dHM6IHsgc2l6ZTogNjcsIGNvdW50OiAzIH0sXG4gICAgICB9KVxuICAgICk7XG5cbiAgICBzdW0ubk91dHB1dHMuc2hvdWxkLmVxbChzdW0ub3V0cHV0cy5jb3VudCk7XG4gIH0pO1xuXG4gIGl0KCdwcm92aWRlcyBzb21lIHR5cGljYWwgb3V0cHV0IHNpemVzJywgZnVuY3Rpb24gKCkge1xuICAgIChcbiAgICAgIFtcbiAgICAgICAgW0RpbWVuc2lvbnMuU2luZ2xlT3V0cHV0LnAyc2gsIFZpcnR1YWxTaXplcy50eFAyc2hPdXRwdXRTaXplXSxcbiAgICAgICAgW0RpbWVuc2lvbnMuU2luZ2xlT3V0cHV0LnAyc2hQMndzaCwgVmlydHVhbFNpemVzLnR4UDJzaFAyd3NoT3V0cHV0U2l6ZV0sXG4gICAgICAgIFtEaW1lbnNpb25zLlNpbmdsZU91dHB1dC5wMndzaCwgVmlydHVhbFNpemVzLnR4UDJ3c2hPdXRwdXRTaXplXSxcbiAgICAgICAgW0RpbWVuc2lvbnMuU2luZ2xlT3V0cHV0LnAycGtoLCBWaXJ0dWFsU2l6ZXMudHhQMnBraE91dHB1dFNpemVdLFxuICAgICAgICBbRGltZW5zaW9ucy5TaW5nbGVPdXRwdXQucDJ3cGtoLCBWaXJ0dWFsU2l6ZXMudHhQMndwa2hPdXRwdXRTaXplXSxcbiAgICAgICAgW0RpbWVuc2lvbnMuU2luZ2xlT3V0cHV0LnAydHIsIFZpcnR1YWxTaXplcy50eFAydHJPdXRwdXRTaXplXSxcbiAgICAgIF0gYXMgW0RpbWVuc2lvbnMsIG51bWJlcl1bXVxuICAgICkuZm9yRWFjaCgoW2RpbXMsIHNpemVdKSA9PiB7XG4gICAgICBkaW1zLmdldE91dHB1dHNWU2l6ZSgpLnNob3VsZC5lcWwoc2l6ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdwcmV2ZW50cyBzdW0gb2YgaW52YWxpZCBkYXRhJywgZnVuY3Rpb24gKCkge1xuICAgIHNob3VsZC5kb2VzTm90VGhyb3coKCkgPT4gRGltZW5zaW9ucy5zdW0oeyBvdXRwdXRzOiB7IGNvdW50OiAwLCBzaXplOiAwIH0gfSkpO1xuICAgIHNob3VsZC5kb2VzTm90VGhyb3coKCkgPT4gRGltZW5zaW9ucy5zdW0oeyBvdXRwdXRzOiB7IGNvdW50OiAxLCBzaXplOiAxIH0gfSkpO1xuICAgIHNob3VsZC50aHJvd3MoKCkgPT4gRGltZW5zaW9ucy5zdW0oeyBuT3V0cHV0czogMSB9KSk7XG4gICAgc2hvdWxkLnRocm93cygoKSA9PiBEaW1lbnNpb25zLnN1bSh7IG5PdXRwdXRzOiAxLCBvdXRwdXRzOiB7IGNvdW50OiAyLCBzaXplOiAxIH0gfSkpO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBzaG91bGQudGhyb3dzKCgpID0+IERpbWVuc2lvbnMuc3VtKHsgblAyc2hJbnB1dHM6IDEgfSwgeyBuUDJzaElucHV0czogJ2ZvbycgfSkpO1xuICAgIHNob3VsZC50aHJvd3MoKCkgPT4gRGltZW5zaW9ucy5zdW0oeyBvdXRwdXRzOiB7IGNvdW50OiAxLCBzaXplOiAwIH0gfSkpO1xuICAgIHNob3VsZC50aHJvd3MoKCkgPT4gRGltZW5zaW9ucy5zdW0oeyBvdXRwdXRzOiB7IGNvdW50OiAwLCBzaXplOiAxIH0gfSkpO1xuICAgIHNob3VsZC50aHJvd3MoKCkgPT4gRGltZW5zaW9ucy5zdW0oeyBvdXRwdXRzOiB7IGNvdW50OiAxLCBzaXplOiAxIH0gfSwgeyBvdXRwdXRzOiB7IGNvdW50OiAxLCBzaXplOiAwIH0gfSkpO1xuICB9KTtcblxuICBpdCgnY291bnRzIGlucHV0cyBjb3JyZWN0bHknLCBmdW5jdGlvbiAoKSB7XG4gICAgT2JqZWN0LmVudHJpZXMoRGltZW5zaW9ucy5TaW5nbGVJbnB1dCkuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICB2YWx1ZS5uSW5wdXRzLnNob3VsZC5lcWwoMSwga2V5KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ211bHRpcGxpZXMgY29ycmVjdGx5JywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGQgPSBuZXcgRGltZW5zaW9ucyh7XG4gICAgICBuUDJzaElucHV0czogMSxcbiAgICAgIG5QMnNoUDJ3c2hJbnB1dHM6IDIsXG4gICAgICBuUDJ3c2hJbnB1dHM6IDMsXG4gICAgICBuUDJ0cktleXBhdGhJbnB1dHM6IDQsXG4gICAgICBuUDJ0clNjcmlwdFBhdGhMZXZlbDFJbnB1dHM6IDUsXG4gICAgICBuUDJ0clNjcmlwdFBhdGhMZXZlbDJJbnB1dHM6IDYsXG4gICAgICBuUDJzaFAycGtJbnB1dHM6IDcsXG4gICAgICBvdXRwdXRzOiB7IGNvdW50OiAxLCBzaXplOiAyMiB9LFxuICAgIH0pLnRpbWVzKDMpO1xuXG4gICAgZC5zaG91bGQuZXFsKFxuICAgICAgbmV3IERpbWVuc2lvbnMoe1xuICAgICAgICBuUDJzaElucHV0czogMyxcbiAgICAgICAgblAyc2hQMndzaElucHV0czogNixcbiAgICAgICAgblAyd3NoSW5wdXRzOiA5LFxuICAgICAgICBuUDJ0cktleXBhdGhJbnB1dHM6IDEyLFxuICAgICAgICBuUDJ0clNjcmlwdFBhdGhMZXZlbDFJbnB1dHM6IDE1LFxuICAgICAgICBuUDJ0clNjcmlwdFBhdGhMZXZlbDJJbnB1dHM6IDE4LFxuICAgICAgICBuUDJzaFAycGtJbnB1dHM6IDIxLFxuICAgICAgICBvdXRwdXRzOiB7IGNvdW50OiAzLCBzaXplOiA2NiB9LFxuICAgICAgfSlcbiAgICApO1xuXG4gICAgZC5nZXROSW5wdXRzKCkuc2hvdWxkLmVxbCg4NCk7XG4gICAgZC5uSW5wdXRzLnNob3VsZC5lcWwoODQpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnRGltZW5zaW9ucyBmcm9tIHVuc3BlbnQgdHlwZXMnLCBmdW5jdGlvbiAoKSB7XG4gIGl0KCdkZXRlcm1pbmVzIHVuc3BlbnQgc2l6ZSBhY2NvcmRpbmcgdG8gY2hhaW4nLCBmdW5jdGlvbiAoKSB7XG4gICAgY2hhaW5Db2Rlc1Ayc2guZm9yRWFjaCgoY2hhaW4pID0+IERpbWVuc2lvbnMuZnJvbVVuc3BlbnQoeyBjaGFpbiB9KS5zaG91bGQuZXFsKERpbWVuc2lvbnMuc3VtKHsgblAyc2hJbnB1dHM6IDEgfSkpKTtcblxuICAgIGNoYWluQ29kZXNQMnNoUDJ3c2guZm9yRWFjaCgoY2hhaW4pID0+XG4gICAgICBEaW1lbnNpb25zLmZyb21VbnNwZW50KHsgY2hhaW4gfSkuc2hvdWxkLmVxbChEaW1lbnNpb25zLnN1bSh7IG5QMnNoUDJ3c2hJbnB1dHM6IDEgfSkpXG4gICAgKTtcblxuICAgIGNoYWluQ29kZXNQMndzaC5mb3JFYWNoKChjaGFpbikgPT5cbiAgICAgIERpbWVuc2lvbnMuZnJvbVVuc3BlbnQoeyBjaGFpbiB9KS5zaG91bGQuZXFsKERpbWVuc2lvbnMuc3VtKHsgblAyd3NoSW5wdXRzOiAxIH0pKVxuICAgICk7XG5cbiAgICBjaGFpbkNvZGVzUDJ0ci5mb3JFYWNoKChjaGFpbikgPT4ge1xuICAgICAgRGltZW5zaW9ucy5mcm9tVW5zcGVudCh7IGNoYWluIH0pLnNob3VsZC5lcWwoRGltZW5zaW9ucy5zdW0oeyBuUDJ0clNjcmlwdFBhdGhMZXZlbDFJbnB1dHM6IDEgfSkpO1xuICAgICAgRGltZW5zaW9ucy5mcm9tVW5zcGVudChcbiAgICAgICAgeyBjaGFpbiB9LFxuICAgICAgICB7IHAydHI6IHsgc2NyaXB0UGF0aExldmVsOiAyIH0sIHAydHJNdXNpZzI6IHsgc2NyaXB0UGF0aExldmVsOiB1bmRlZmluZWQgfSB9XG4gICAgICApLnNob3VsZC5lcWwoRGltZW5zaW9ucy5zdW0oeyBuUDJ0clNjcmlwdFBhdGhMZXZlbDJJbnB1dHM6IDEgfSkpO1xuICAgIH0pO1xuXG4gICAgY2hhaW5Db2Rlc1AydHJNdXNpZzIuZm9yRWFjaCgoY2hhaW4pID0+IHtcbiAgICAgIERpbWVuc2lvbnMuZnJvbVVuc3BlbnQoeyBjaGFpbiB9KS5zaG91bGQuZXFsKERpbWVuc2lvbnMuc3VtKHsgblAydHJTY3JpcHRQYXRoTGV2ZWwxSW5wdXRzOiAxIH0pKTtcbiAgICAgIERpbWVuc2lvbnMuZnJvbVVuc3BlbnQoXG4gICAgICAgIHsgY2hhaW4gfSxcbiAgICAgICAgeyBwMnRyOiB7IHNjcmlwdFBhdGhMZXZlbDogdW5kZWZpbmVkIH0sIHAydHJNdXNpZzI6IHsgc2NyaXB0UGF0aExldmVsOiB1bmRlZmluZWQgfSB9XG4gICAgICApLnNob3VsZC5lcWwoRGltZW5zaW9ucy5zdW0oeyBuUDJ0cktleXBhdGhJbnB1dHM6IDEgfSkpO1xuICAgIH0pO1xuXG4gICAgRGltZW5zaW9ucy5mcm9tVW5zcGVudHMoY2hhaW5Db2Rlcy5tYXAoKGNoYWluKSA9PiAoeyBjaGFpbiB9KSkpLnNob3VsZC5lcWwoXG4gICAgICBuZXcgRGltZW5zaW9ucyh7XG4gICAgICAgIG5QMnNoUDJ3c2hJbnB1dHM6IDIsXG4gICAgICAgIG5QMnNoSW5wdXRzOiAyLFxuICAgICAgICBuUDJ3c2hJbnB1dHM6IDIsXG4gICAgICAgIG5QMnRyS2V5cGF0aElucHV0czogMCxcbiAgICAgICAgblAydHJTY3JpcHRQYXRoTGV2ZWwxSW5wdXRzOiA0LFxuICAgICAgICBuUDJ0clNjcmlwdFBhdGhMZXZlbDJJbnB1dHM6IDAsXG4gICAgICAgIG5QMnNoUDJwa0lucHV0czogMCxcbiAgICAgICAgb3V0cHV0czogeyBjb3VudDogMCwgc2l6ZTogMCB9LFxuICAgICAgfSlcbiAgICApO1xuICB9KTtcblxuICBpdCgnY2FsY3VsYXRlcyBvdXRwdXQgZGltZW5zaW9ucyBkeW5hbWljYWxseScsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBleHBlY3RlZFNpemVzID0gbmV3IE1hcChbXG4gICAgICBbVW5zcGVudFR5cGVTY3JpcHQyb2YzLnAyc2gsIFZpcnR1YWxTaXplcy50eFAyc2hPdXRwdXRTaXplXSxcbiAgICAgIFtVbnNwZW50VHlwZVNjcmlwdDJvZjMucDJzaFAyd3NoLCBWaXJ0dWFsU2l6ZXMudHhQMnNoUDJ3c2hPdXRwdXRTaXplXSxcbiAgICAgIFtVbnNwZW50VHlwZVNjcmlwdDJvZjMucDJ3c2gsIFZpcnR1YWxTaXplcy50eFAyd3NoT3V0cHV0U2l6ZV0sXG4gICAgICBbVW5zcGVudFR5cGVTY3JpcHQyb2YzLnAydHIsIFZpcnR1YWxTaXplcy50eFAydHJPdXRwdXRTaXplXSxcbiAgICAgIFtVbnNwZW50VHlwZVNjcmlwdDJvZjMucDJ0ck11c2lnMiwgVmlydHVhbFNpemVzLnR4UDJ0ck91dHB1dFNpemVdLFxuICAgICAgW1Vuc3BlbnRUeXBlU2NyaXB0Mm9mMy50YXByb290S2V5UGF0aFNwZW5kLCBWaXJ0dWFsU2l6ZXMudHhQMnRyT3V0cHV0U2l6ZV0sXG4gICAgICBbVW5zcGVudFR5cGVQdWJLZXlIYXNoLnAycGtoLCBWaXJ0dWFsU2l6ZXMudHhQMnBraE91dHB1dFNpemVdLFxuICAgICAgW1Vuc3BlbnRUeXBlUHViS2V5SGFzaC5wMndwa2gsIFZpcnR1YWxTaXplcy50eFAyd3BraE91dHB1dFNpemVdLFxuICAgIF0pO1xuXG4gICAgWy4uLk9iamVjdC5rZXlzKFVuc3BlbnRUeXBlU2NyaXB0Mm9mMyksIC4uLk9iamVjdC5rZXlzKFVuc3BlbnRUeXBlUHViS2V5SGFzaCldLmZvckVhY2goKHR5cGUpID0+XG4gICAgICBnZXRPdXRwdXREaW1lbnNpb25zRm9yVW5zcGVudFR5cGUodHlwZSkub3V0cHV0cy5zaXplLnNob3VsZC5lcWwoZXhwZWN0ZWRTaXplcy5nZXQodHlwZSBhcyBhbnkpKVxuICAgICk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdEaW1lbnNpb25zIGVzdGltYXRlcycsIGZ1bmN0aW9uICgpIHtcbiAgaXQoJ2NhbGN1bGF0ZXMgdnNpemVzJywgZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIGRpbShuUDJzaElucHV0czogbnVtYmVyLCBuUDJzaFAyd3NoSW5wdXRzOiBudW1iZXIsIG5QMndzaElucHV0czogbnVtYmVyLCBuT3V0cHV0czogbnVtYmVyKTogRGltZW5zaW9ucyB7XG4gICAgICByZXR1cm4gRGltZW5zaW9ucy5zdW0oXG4gICAgICAgIHtcbiAgICAgICAgICBuUDJzaElucHV0cyxcbiAgICAgICAgICBuUDJzaFAyd3NoSW5wdXRzLFxuICAgICAgICAgIG5QMndzaElucHV0cyxcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0T3V0cHV0RGltZW5zaW9uc0ZvclVuc3BlbnRUeXBlKFVuc3BlbnRUeXBlUHViS2V5SGFzaC5wMnBraCkudGltZXMobk91dHB1dHMpXG4gICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRpbVAydHIoXG4gICAgICBuUDJ0cktleXBhdGhJbnB1dHM6IG51bWJlcixcbiAgICAgIG5QMnRyU2NyaXB0UGF0aExldmVsMUlucHV0czogbnVtYmVyLFxuICAgICAgblAydHJTY3JpcHRQYXRoTGV2ZWwySW5wdXRzOiBudW1iZXIsXG4gICAgICBuT3V0cHV0czogbnVtYmVyXG4gICAgKTogRGltZW5zaW9ucyB7XG4gICAgICByZXR1cm4gRGltZW5zaW9ucy5zdW0oXG4gICAgICAgIHtcbiAgICAgICAgICBuUDJ0cktleXBhdGhJbnB1dHMsXG4gICAgICAgICAgblAydHJTY3JpcHRQYXRoTGV2ZWwxSW5wdXRzLFxuICAgICAgICAgIG5QMnRyU2NyaXB0UGF0aExldmVsMklucHV0cyxcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0T3V0cHV0RGltZW5zaW9uc0ZvclVuc3BlbnRUeXBlKFVuc3BlbnRUeXBlUHViS2V5SGFzaC5wMnBraCkudGltZXMobk91dHB1dHMpXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHZlY3RvcnM6IFtEaW1lbnNpb25zLCB1bmtub3duW11dW10gPSBbXG4gICAgICBbZGltKDEsIDAsIDAsIDEpLCBbZmFsc2UsIDEwLCAyOTgsIDM0LCAzNDJdXSxcbiAgICAgIFtkaW0oMCwgMSwgMCwgMSksIFt0cnVlLCAxMSwgMTQwLCAzNCwgMTg1XV0sXG4gICAgICBbZGltKDAsIDAsIDEsIDEpLCBbdHJ1ZSwgMTEsIDEwNSwgMzQsIDE1MF1dLFxuICAgICAgW2RpbSgyLCAwLCAwLCAxKSwgW2ZhbHNlLCAxMCwgNTk2LCAzNCwgNjQwXV0sXG4gICAgICBbZGltKDAsIDIsIDAsIDEpLCBbdHJ1ZSwgMTEsIDI4MCwgMzQsIDMyNV1dLFxuICAgICAgW2RpbSgwLCAwLCAyLCAxKSwgW3RydWUsIDExLCAyMTAsIDM0LCAyNTVdXSxcbiAgICAgIFtkaW0oMSwgMSwgMSwgMSksIFt0cnVlLCAxMSwgNTQzLCAzNCwgNTg4XV0sXG4gICAgICBbZGltKDEsIDEsIDEsIDIpLCBbdHJ1ZSwgMTEsIDU0MywgNjgsIDYyMl1dLFxuXG4gICAgICBbZGltUDJ0cigxLCAwLCAwLCAxKSwgW3RydWUsIDExLCA1OCwgMzQsIDEwM11dLFxuICAgICAgW2RpbVAydHIoMCwgMSwgMCwgMSksIFt0cnVlLCAxMSwgMTA4LCAzNCwgMTUzXV0sXG4gICAgICBbZGltUDJ0cigwLCAwLCAxLCAxKSwgW3RydWUsIDExLCAxMTYsIDM0LCAxNjFdXSxcbiAgICBdO1xuXG4gICAgdmVjdG9ycy5mb3JFYWNoKChbZGltZW5zaW9ucywgcHJvcHNdKSA9PiB7XG4gICAgICBbXG4gICAgICAgIGRpbWVuc2lvbnMuaXNTZWd3aXQoKSxcbiAgICAgICAgZGltZW5zaW9ucy5nZXRPdmVyaGVhZFZTaXplKCksXG4gICAgICAgIGRpbWVuc2lvbnMuZ2V0SW5wdXRzVlNpemUoKSxcbiAgICAgICAgZGltZW5zaW9ucy5nZXRPdXRwdXRzVlNpemUoKSxcbiAgICAgICAgZGltZW5zaW9ucy5nZXRWU2l6ZSgpLFxuICAgICAgXS5zaG91bGQuZXFsKHByb3BzKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==